{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/Header.vue?6142","webpack:///./src/components/drawer/Maps.vue?cdac","webpack:///./src/components/drawer/Metadata.vue?845a","webpack:///./src/components/Sidebar.vue?318d","webpack:///./src/components/Georeference.vue?c8bd","webpack:///./src/App.vue?26a0","webpack:///./src/components/Header.vue?a8b6","webpack:///src/components/Header.vue","webpack:///./src/components/Header.vue?4c35","webpack:///./src/components/Header.vue","webpack:///./src/components/Drawer.vue?deea","webpack:///./src/components/drawer/Metadata.vue?f45f","webpack:///src/components/drawer/Metadata.vue","webpack:///./src/components/drawer/Metadata.vue?47c0","webpack:///./src/components/drawer/Metadata.vue","webpack:///./src/components/drawer/Maps.vue?20ee","webpack:///./src/lib/functions.js","webpack:///src/components/drawer/Maps.vue","webpack:///./src/components/drawer/Maps.vue?23fe","webpack:///./src/components/drawer/Maps.vue","webpack:///./src/components/drawer/Annotation.vue?95e0","webpack:///src/components/drawer/Annotation.vue","webpack:///./src/components/drawer/Annotation.vue?e321","webpack:///./src/components/drawer/Annotation.vue","webpack:///src/components/Drawer.vue","webpack:///./src/components/Drawer.vue?1a5b","webpack:///./src/components/Drawer.vue","webpack:///./src/components/Sidebar.vue?b369","webpack:///src/components/Sidebar.vue","webpack:///./src/components/Sidebar.vue?d975","webpack:///./src/components/Sidebar.vue","webpack:///./src/components/Home.vue?0d58","webpack:///src/components/Home.vue","webpack:///./src/components/Home.vue?705d","webpack:///./src/components/Home.vue","webpack:///./src/components/Collection.vue?ab74","webpack:///./src/components/Thumbnail.vue?473a","webpack:///src/components/Thumbnail.vue","webpack:///./src/components/Thumbnail.vue?5195","webpack:///./src/components/Thumbnail.vue","webpack:///src/components/Collection.vue","webpack:///./src/components/Collection.vue?32e7","webpack:///./src/components/Collection.vue","webpack:///./src/components/Georeference.vue?4597","webpack:///./src/lib/openlayers.js","webpack:///./src/lib/map.js","webpack:///src/components/Georeference.vue","webpack:///./src/components/Georeference.vue?65e2","webpack:///./src/components/Georeference.vue","webpack:///./src/components/PixelMask.vue?14b1","webpack:///src/components/PixelMask.vue","webpack:///./src/components/PixelMask.vue?de38","webpack:///./src/components/PixelMask.vue","webpack:///./src/components/Results.vue?8f97","webpack:///src/components/Results.vue","webpack:///./src/components/Results.vue?e9c0","webpack:///./src/components/Results.vue","webpack:///./src/lib/json1-operations.js","webpack:///src/App.vue","webpack:///./src/App.vue?1160","webpack:///./src/App.vue","webpack:///./src/store/modules/maps.js","webpack:///./src/store/modules/ui.js","webpack:///./src/lib/api.js","webpack:///./src/store/modules/iiif.js","webpack:///./src/store/index.js","webpack:///./src/main.js","webpack:///./src/components/Drawer.vue?89fd","webpack:///./src/components/Collection.vue?1f43","webpack:///./src/App.vue?2398","webpack:///./src/components/PixelMask.vue?657b","webpack:///./src/components/Results.vue?e90b","webpack:///./src/components/Thumbnail.vue?1af3","webpack:///./src/components/drawer/Annotation.vue?4c6d","webpack:///./src/components/Home.vue?69cc"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","_m","staticClass","$route","query","url","_e","staticRenderFns","_v","maskTooltipTriggers","scopedSlots","_u","fn","proxy","on","$event","setSidebarOpen","open","computed","image","watch","inputUrl","methods","handleSubmit","$router","component","drawerOpen","_s","label","activeImage","imageCount","index","previousImageId","nextImageId","toggleDrawer","description","_l","item","maps","keys","map","mapId","class","active","activeMapId","mapClicked","hasPixelMask","thumbnailViewbox","thumbnailPolygonPoints","stopPropagation","removeMap","source","hasGcps","gcp","gcpId","printImageCoordinate","printWorldCoordinate","world","removeGcp","round","num","decimals","pow","Math","Number","EPSILON","coordinate","pixelMask","gcps","maskExtent","maskDimensions","points","setActiveMapId","$options","directives","rawName","expression","copy","download","activeImageId","annotation","annotationString","JSON","stringify","getAnnotationImage","version","dimensions","undefined","width","height","quality","format","navigator","clipboard","writeText","$buefy","toast","message","type","document","body","appendChild","a","style","href","dataUrl","click","URL","revokeObjectURL","components","Metadata","Maps","Annotation","hasMetadata","metadata","model","callback","$$v","shortcut","shortcuts","$store","state","ui","sidebarOpen","set","props","images","imageId","stub","getImageUrl","thumbnail","tilesWidth","scale","tilesHeight","gridTemplateRows","rowCount","gridTemplateColumns","columnCount","row","rowIndex","cell","columnIndex","size","removeHeight","default","singleImage","Array","isArray","firstRow","reduce","max","getThumbnail","region","Thumbnail","mapsForImage","values","some","deleteCondition","event","shiftKeyOnly","singleClick","createFullImageMap","createRandomId","id","uri","singleIiifFeatures","singleMapFeatures","iiifSource","changed","initalizeGCPs","activeMap","updateImage","onStoreMutation","mutation","payload","iiifFeature","removeFeature","mapFeature","mapSource","geometry","Point","addFeature","properties","coordinates","clearGcps","onResize","iiifOl","mapOl","updateSize","pointDifference","iiifFeatures","mapFeatures","gcpFromGcpId","iiifPoint","iiifFeatureToPoint","mapPoint","mapFeatureToPoint","clear","addFeatures","getView","fit","extent","padding","maxZoom","transform","getCoordinates","onEdited","options","Error","zDirection","iiifLayer","setSource","iiifTileSource","setView","View","enableRotation","resolutions","getTileGrid","getResolutions","constrainOnlyCenter","getExtent","gcpStyle","Style","stroke","Stroke","color","Circle","radius","fill","Fill","text","gcpTextStyle","feature","Text","gcpLabel","offsetX","offsetY","String","mounted","Tile","iiifVector","Vector","Map","layers","target","mapLayer","XYZ","tileSources","mapVector","controls","view","center","zoom","iiifModify","Modify","mapModify","addInteraction","iiifDraw","mapDraw","storeUnsubscribe","subscribe","beforeDestroy","un","updateStyles","initializePixelMasks","Polygon","setId","setStyle","maskStyle","pointsEqual","point1","point2","polygonDifference","minLength","oldPolygon","newPolygon","operation","pixelMaskPoint","polygonToMask","polygon","maskToPolygon","featurePolygon","getGeometry","maskTextStyle","maskLabel","placement","align","baseline","overflow","freehandCondition","viewerUrl","annotationUrl","manifestId","isObject","obj","parseOperations","op","flat","parseMapOp","instructions","prop","parsePropOp","Header","Drawer","Sidebar","Home","Collection","Georeference","PixelMask","Results","initializeDoc","doc","json1","snackbar","position","setMaps","getDoc","removeListener","remoteOperation","unsubscribe","destroy","connection","localOperation","operations","forEach","submitOp","insertOp","parse","removeOp","replaceOp","goToRoute","keyPressHandler","fullscreen","setIiifUrl","setActiveImageId","resetMaps","removeEventListener","close","rws","makeMapActive","rootState","commit","root","makeOtherMapActive","otherMapId","loopMapId","getters","actions","undo","Toast","redo","firstMapId","dispatch","insertMap","insertPixelMaskPoint","replacePixelMaskPoint","removePixelMaskPoint","insertGcp","replaceGcp","mutations","Vue","delete","namespaced","lastError","loading","iiif","imagesById","previousMapId","mapIds","currentMapIndex","indexOf","newMapIndex","nextMapId","drawer","setDrawerOpen","API_URL","process","fetchJson","fetch","then","response","json","submitIiif","createChecksum","checksum","apiUrl","apiData","method","headers","responseData","getString","en","includes","DOMParser","parseFromString","textContent","initialState","loaded","parsedIiif","sourceData","filter","sourceIiif","parseIiif","createId","newImageId","newRoute","router","currentRoute","loadImageInfo","imageStub","parsedImage","setIiif","setImage","use","Vuex","Store","VueRouter","Buefy","defaultIconPack","defaultContainerElement","config","productionTip","directive","deep","el","binding","targets","querySelectorAll","hljs","highlightBlock","componentUpdated","routes","path","App","store","render","h","$mount"],"mappings":"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","file":"js/app.8b57a3f6.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/editor/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Header.vue?vue&type=style&index=0&id=2464ebaf&scoped=true&lang=css&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Maps.vue?vue&type=style&index=0&id=659b5317&scoped=true&lang=css&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Metadata.vue?vue&type=style&index=0&id=004f1e2a&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Sidebar.vue?vue&type=style&index=0&id=121bdc8a&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Georeference.vue?vue&type=style&index=0&id=836ffa9e&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_vm._m(0),_c('div',{staticClass:\"main\"},[_c('Header'),_c('main',[(_vm.$route.name === 'home' || !_vm.$route.query.url)?[_c('Home')]:(_vm.$route.name === 'collection')?[_c('Collection')]:(_vm.$route.name === 'mask')?[_c('PixelMask')]:(_vm.$route.name === 'georeference')?[_c('Georeference')]:(_vm.$route.name === 'results')?[_c('Results')]:_vm._e()],2),(_vm.$route.name !== 'home')?_c('Drawer'):_vm._e(),_c('Sidebar')],1)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"banner\"},[_vm._v(\" This website is not yet finished. Not everything will work as intended, and some things will not work at all. Follow \"),_c('a',{attrs:{\"href\":\"https://twitter.com/bertspaan\"}},[_vm._v(\"@bertspaan\")]),_vm._v(\" for updates. \")])}]\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('header',{staticClass:\"padding\"},[_vm._m(0),(_vm.$route.query.url)?_c('nav',[_c('div',{staticClass:\"buttons field has-addons\"},[_c('p',{staticClass:\"control\"},[_c('b-button',{attrs:{\"tag\":\"router-link\",\"icon-left\":\"layer-group\",\"to\":{ name: 'collection', query: _vm.query },\"type\":\"is-link is-collection\"}},[_vm._v(\" Collection \")])],1),_c('p',{staticClass:\"control\"},[_c('b-tooltip',{attrs:{\"position\":\"is-bottom\",\"multilined\":\"\",\"triggers\":_vm.maskTooltipTriggers,\"auto-close\":['outside', 'escape']},scopedSlots:_vm._u([{key:\"content\",fn:function(){return [_c('b-field',[_c('b-switch',{attrs:{\"value\":true,\"type\":\"is-success\"}},[_vm._v(\" This image contains one or more maps. \")])],1)]},proxy:true}],null,false,6107357)},[_c('b-button',{attrs:{\"tag\":\"router-link\",\"icon-left\":\"draw-polygon\",\"to\":{name: 'mask', query: _vm.query},\"type\":\"is-link is-mask\"}},[_vm._v(\"Mask\")])],1)],1),_c('p',{staticClass:\"control\"},[_c('b-button',{attrs:{\"tag\":\"router-link\",\"icon-left\":\"map-pin\",\"to\":{ name: 'georeference', query: _vm.query },\"type\":\"is-link is-georeference\"}},[_vm._v(\" Georeference \")])],1),_c('p',{staticClass:\"control\"},[_c('b-button',{attrs:{\"tag\":\"router-link\",\"icon-left\":\"globe\",\"to\":{ name: 'results', query: _vm.query },\"type\":\"is-link is-results\"}},[_vm._v(\" Results \")])],1)])]):_vm._e(),_c('b-button',{staticClass:\"is-light\",attrs:{\"pack\":\"fas\",\"icon-right\":\"bars\"},on:{\"click\":function($event){return _vm.setSidebarOpen({ open: true })}}})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h1',[_c('a',{attrs:{\"href\":\"https://allmaps.org/\"}},[_c('img',{attrs:{\"alt\":\"Allmaps\",\"src\":\"https://raw.githubusercontent.com/allmaps/style/master/images/allmaps-logo.svg\"}})])])}]\n\nexport { render, staticRenderFns }","<template>\n  <header class=\"padding\">\n    <h1>\n      <a href=\"https://allmaps.org/\">\n        <img alt=\"Allmaps\"\n          src=\"https://raw.githubusercontent.com/allmaps/style/master/images/allmaps-logo.svg\" />\n      </a>\n    </h1>\n\n    <!-- TODO: replace !$route.query.url with store.ui.loaded -->\n    <nav v-if=\"$route.query.url\">\n      <div class=\"buttons field has-addons\">\n        <p class=\"control\">\n          <b-button tag=\"router-link\"\n            icon-left=\"layer-group\"\n            :to=\"{ name: 'collection', query }\"\n            type=\"is-link is-collection\">\n            Collection\n          </b-button>\n        </p>\n\n        <p class=\"control\">\n          <b-tooltip position=\"is-bottom\" multilined\n            :triggers=\"maskTooltipTriggers\" :auto-close=\"['outside', 'escape']\">\n            <b-button tag=\"router-link\"\n              icon-left=\"draw-polygon\"\n              :to=\"{name: 'mask', query}\"\n              type=\"is-link is-mask\">Mask</b-button>\n              <template v-slot:content>\n                <b-field>\n                  <b-switch :value=\"true\"\n                    type=\"is-success\">\n                    This image contains one or more maps.\n                  </b-switch>\n                </b-field>\n                <!-- <p></p> -->\n            </template>\n          </b-tooltip>\n        </p>\n\n        <p class=\"control\">\n          <b-button tag=\"router-link\"\n            icon-left=\"map-pin\"\n            :to=\"{ name: 'georeference', query }\"\n            type=\"is-link is-georeference\">\n            Georeference\n          </b-button>\n        </p>\n\n        <p class=\"control\">\n          <b-button tag=\"router-link\"\n            icon-left=\"globe\"\n            :to=\"{ name: 'results', query }\"\n            type=\"is-link is-results\">\n            Results\n          </b-button>\n        </p>\n      </div>\n    </nav>\n\n    <b-button class=\"is-light\" @click=\"setSidebarOpen({ open: true })\"\n      pack=\"fas\" icon-right=\"bars\" />\n  </header>\n</template>\n\n<script>\nimport { mapState, mapActions } from 'vuex'\n\nexport default {\n  name: 'Header',\n  computed: {\n    ...mapState({\n      activeImageId: (state) => state.ui.activeImageId,\n      maps: (state) => state.maps.maps\n    }),\n    maskTooltipTriggers: function () {\n      return []\n      // return Object.keys(this.maps).length ? [] : ['click']\n    },\n    query: function () {\n      return {\n        url: this.$route.query.url,\n        image: this.$route.query.image\n      }\n    }\n  },\n  watch: {\n    '$route.query.url': function () {\n      this.inputUrl = this.$route.query.url\n    }\n  },\n  methods: {\n    ...mapActions('ui', [\n      'setSidebarOpen'\n    ]),\n\n    handleSubmit () {\n      this.$router.push({ name: this.$route.name, query: {\n        url: this.inputUrl\n      }})\n    }\n  }\n}\n</script>\n\n<style scoped>\nheader {\n  position: absolute;\n\n  z-index: 35;\n  width: 100%;\n\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  pointer-events: none;\n}\n\nheader > * {\n  pointer-events: all;\n}\n\nh1 img {\n  width: 40px;\n}\n\nnav a.button {\n  color: black;\n  background: white;\n  border-color: #bbb;\n}\n\nnav a.button:hover, nav a.button:active {\n  color: black;\n}\n\na.button.router-link-exact-active.collection {\n  background-color: var(--blue-1);\n  border-color: var(--blue-2);\n}\n\n/* a.router-link-exact-active.collection {\n  background-color: var(--blue-1);\n  border-color: var(--blue-2);\n} */\n\na.router-link-exact-active.mask {\n  background-color: var(--purple-1);\n  border-color: var(--purple-2);\n}\n\na.router-link-exact-active.georeference {\n  background-color: var(--green-1);\n  border-color: var(--green-2);\n}\n\na.router-link-exact-active.results {\n  background-color: var(--yellow-1);\n  border-color: var(--yellow-2);\n}\n\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Header.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Header.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Header.vue?vue&type=template&id=2464ebaf&scoped=true&\"\nimport script from \"./Header.vue?vue&type=script&lang=js&\"\nexport * from \"./Header.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Header.vue?vue&type=style&index=0&id=2464ebaf&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2464ebaf\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('footer',{staticClass:\"padding\"},[_c('div',{staticClass:\"drawer box\"},[(_vm.drawerOpen)?[(_vm.drawerOpen === 'metadata')?_c('Metadata'):(_vm.drawerOpen === 'maps')?_c('Maps'):(_vm.drawerOpen === 'annotation')?_c('Annotation'):_vm._e(),_c('hr')]:_vm._e(),_c('div',{staticClass:\"base\"},[_c('div',[_c('h3',{staticClass:\"label\"},[_vm._v(_vm._s(_vm.label))]),_c('div',{staticClass:\"select-image\"},[(_vm.activeImage && _vm.imageCount > 1)?[_c('span',[_vm._v(\" Image \"+_vm._s(_vm.activeImage.index + 1)+\"/\"+_vm._s(_vm.imageCount)+\" \")]),_c('div',{staticClass:\"buttons prev-next-buttons\"},[_c('b-button',{attrs:{\"size\":\"is-small\",\"icon-left\":\"arrow-left\",\"disabled\":!_vm.activeImage.previousImageId,\"tag\":\"router-link\",\"type\":\"is-link\",\"to\":{\n                name: _vm.$route.name,\n                query: {\n                  url: _vm.$route.query.url,\n                  image: _vm.activeImage.previousImageId\n                }}}}),_c('b-button',{attrs:{\"size\":\"is-small\",\"icon-left\":\"arrow-right\",\"disabled\":!_vm.activeImage.nextImageId,\"tag\":\"router-link\",\"type\":\"is-link\",\"to\":{\n                name: _vm.$route.name,\n                query: {\n                  url: _vm.$route.query.url,\n                  image: _vm.activeImage.nextImageId\n                }}}})],1)]:_vm._e()],2)]),_c('div',{staticClass:\"controls\"},[_c('div',{staticClass:\"buttons drawer-buttons\"},[(_vm.hasMetadata)?_c('b-button',{attrs:{\"active\":_vm.drawerOpen === 'metadata',\"icon-right\":\"info\"},on:{\"click\":function($event){return _vm.toggleDrawer('metadata')}}}):_vm._e(),_c('b-button',{attrs:{\"active\":_vm.drawerOpen === 'maps',\"icon-right\":\"list\"},on:{\"click\":function($event){return _vm.toggleDrawer('maps')}}}),_c('b-button',{attrs:{\"active\":_vm.drawerOpen === 'annotation',\"icon-right\":\"code\"},on:{\"click\":function($event){return _vm.toggleDrawer('annotation')}}})],1)])])],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"drawer-content content\"},[(_vm.label)?_c('h3',[_vm._v(_vm._s(_vm.label))]):_vm._e(),(_vm.description)?_c('p',[_vm._v(_vm._s(_vm.description))]):_vm._e(),(_vm.metadata)?_c('dl',_vm._l((_vm.metadata),function(item,index){return _c('div',{key:index},[_c('dt',[_vm._v(_vm._s(item.label)+\" \")]),_c('dd',[_vm._v(_vm._s(item.value)+\" \")])])}),0):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"drawer-content content\">\n    <h3 v-if=\"label\">{{ label }}</h3>\n    <p v-if=\"description\">{{ description }}</p>\n    <dl v-if=\"metadata\">\n      <div v-for=\"(item, index) in metadata\" :key=\"index\">\n        <dt>{{ item.label }} </dt>\n        <dd>{{ item.value }} </dd>\n      </div>\n    </dl>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\n\nexport default {\n  name: 'Metadata',\n  computed: {\n    ...mapGetters('iiif', {\n      label: 'label',\n      description: 'description',\n      metadata: 'metadata'\n    })\n  }\n}\n</script>\n\n<style scoped>\n.drawer-content {\n  margin-bottom: 1rem;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Metadata.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Metadata.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Metadata.vue?vue&type=template&id=004f1e2a&scoped=true&\"\nimport script from \"./Metadata.vue?vue&type=script&lang=js&\"\nexport * from \"./Metadata.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Metadata.vue?vue&type=style&index=0&id=004f1e2a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"004f1e2a\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.maps && Object.keys(_vm.maps).length)?_c('ol',{staticClass:\"drawer-content maps\"},_vm._l((_vm.maps),function(map,mapId,index){return _c('li',{key:mapId,class:{\n      active: _vm.activeMapId === mapId\n    },on:{\"click\":function($event){return _vm.mapClicked(mapId)}}},[_c('div',{staticClass:\"map\"},[_c('div',{staticClass:\"index\"},[_c('div',{staticClass:\"thumbnail\"},[(_vm.hasPixelMask(map))?_c('svg',{attrs:{\"viewBox\":_vm.thumbnailViewbox(map)}},[_c('polygon',{attrs:{\"points\":_vm.thumbnailPolygonPoints(map)}})]):_vm._e(),_c('span',[_vm._v(_vm._s(index + 1))])]),_c('span',[_vm._v(\"Map \"+_vm._s(index + 1))])]),_c('b-button',{staticClass:\"is-white\",attrs:{\"icon-left\":\"trash\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.removeMap({ mapId: mapId, source: _vm.source })}}})],1),(_vm.activeMapId === mapId && _vm.hasGcps(map))?_c('ol',{staticClass:\"gcps\"},_vm._l((map.gcps),function(gcp,gcpId,index){return _c('li',{key:gcpId,staticClass:\"gcp\"},[_c('div',{staticClass:\"gcp-data\"},[_c('div',{staticClass:\"gcp-icon\"},[_c('span',{staticClass:\"circle\"}),_c('span',{staticClass:\"index\"},[_vm._v(\" \"+_vm._s(index + 1)+\" \")])]),_c('span',{staticClass:\"gcp-coordinates\"},[(gcp.image)?[_c('span',{staticClass:\"gcp-image-coordinate\"},[_vm._v(_vm._s(_vm.printImageCoordinate(gcp.image[0])))]),_c('span',{staticClass:\"gcp-image-coordinate\"},[_vm._v(_vm._s(_vm.printImageCoordinate(gcp.image[1])))])]:[_c('span',{staticClass:\"gcp-image-coordinate\"}),_c('span',{staticClass:\"gcp-image-coordinate\"})],(gcp.world)?[_c('span',{staticClass:\"gcp-world-coordinate\"},[_vm._v(_vm._s(_vm.printWorldCoordinate(gcp.world[0])))]),_c('span',{staticClass:\"gcp-world-coordinate\"},[_vm._v(_vm._s(_vm.printWorldCoordinate(gcp.world[1])))])]:[_c('span',{staticClass:\"gcp-world-coordinate\"}),_c('span',{staticClass:\"gcp-world-coordinate\"})]],2)]),_c('b-button',{staticClass:\"is-white\",attrs:{\"icon-left\":\"trash\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.removeGcp({ mapId: mapId, gcpId: gcpId, gcp: gcp, source: _vm.source })}}})],1)}),0):_vm._e()])}),0):_c('div',[_vm._v(\" Click and drag to draw mask. \")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export function round (num, decimals = 2) {\n  const pow = 10 ** decimals\n  return Math.round((num + Number.EPSILON) * pow) / pow\n}\n","<template>\n  <ol class=\"drawer-content maps\" v-if=\"maps && Object.keys(maps).length\">\n    <li v-for=\"(map, mapId, index) in maps\" :key=\"mapId\"\n      @click=\"mapClicked(mapId)\" :class=\"{\n        active: activeMapId === mapId\n      }\">\n      <div class=\"map\">\n        <div class=\"index\">\n          <div class=\"thumbnail\">\n            <svg v-if=\"hasPixelMask(map)\"\n              :viewBox=\"thumbnailViewbox(map)\">\n              <polygon\n                :points=\"thumbnailPolygonPoints(map)\" />\n            </svg>\n            <span>{{ index + 1 }}</span>\n          </div>\n          <span>Map {{ index + 1 }}</span>\n        </div>\n        <b-button icon-left=\"trash\" class=\"is-white\"\n          @click.stop=\"removeMap({ mapId, source })\" />\n      </div>\n      <ol class=\"gcps\" v-if=\"activeMapId === mapId && hasGcps(map)\">\n        <li class=\"gcp\" v-for=\"(gcp, gcpId, index) in map.gcps\" :key=\"gcpId\">\n          <div class=\"gcp-data\">\n            <div class=\"gcp-icon\">\n              <span class=\"circle\"></span>\n              <span class=\"index\">\n              {{ index + 1 }}\n              </span>\n            </div>\n            <span class=\"gcp-coordinates\">\n              <template v-if=\"gcp.image\">\n                <span class=\"gcp-image-coordinate\">{{ printImageCoordinate(gcp.image[0]) }}</span>\n                <span class=\"gcp-image-coordinate\">{{ printImageCoordinate(gcp.image[1]) }}</span>\n              </template>\n              <template v-else>\n                <!-- TODO: create placeholder -->\n                <span class=\"gcp-image-coordinate\"></span>\n                <span class=\"gcp-image-coordinate\"></span>\n              </template>\n\n              <template v-if=\"gcp.world\">\n                <span class=\"gcp-world-coordinate\">{{ printWorldCoordinate(gcp.world[0]) }}</span>\n                <span class=\"gcp-world-coordinate\">{{ printWorldCoordinate(gcp.world[1]) }}</span>\n              </template>\n              <template v-else>\n                <!-- TODO: create placeholder -->\n                <span class=\"gcp-world-coordinate\"></span>\n                <span class=\"gcp-world-coordinate\"></span>\n              </template>\n\n\n            </span>\n          </div>\n          <b-button icon-left=\"trash\" class=\"is-white\"\n            @click.stop=\"removeGcp({ mapId, gcpId, gcp, source })\" />\n        </li>\n      </ol>\n    </li>\n  </ol>\n  <div v-else>\n    Click and drag to draw mask.\n  </div>\n</template>\n\n<script>\nimport { mapState, mapActions } from 'vuex'\n\nimport { round } from '../../lib/functions'\n\nexport default {\n  name: 'Maps',\n  methods: {\n    printImageCoordinate: function (coordinate) {\n      return coordinate\n    },\n    printWorldCoordinate: function (coordinate) {\n      return round(coordinate, 5)\n    },\n    hasPixelMask: function (map) {\n      return map && map.pixelMask && map.pixelMask.length > 0\n    },\n    hasGcps: function (map) {\n      return map && map.gcps && Object.keys(map.gcps).length > 0\n    },\n    maskExtent: function (map) {\n      const xs = map.pixelMask.map((point) => point[0])\n      const ys = map.pixelMask.map((point) => point[1])\n\n      const minX = Math.min(...xs)\n      const maxX = Math.max(...xs)\n\n      const minY = Math.min(...ys)\n      const maxY = Math.max(...ys)\n\n      return [\n        [minX, maxX],\n        [minY, maxY]\n      ]\n    },\n    maskDimensions: function (map) {\n      const maskExtent = this.maskExtent(map)\n\n      return [\n        maskExtent[0][1] - maskExtent[0][0],\n        maskExtent[1][1] - maskExtent[1][0]\n      ]\n    },\n    thumbnailViewbox: function (map, padding = 5, maxHeight = 50) {\n      const maskDimensions = this.maskDimensions(map)\n      const scaleFactor = maxHeight / Math.max(...maskDimensions)\n      return `${-padding} ${-padding} ${maskDimensions[0] * scaleFactor + padding * 2} ${maskDimensions[1] * scaleFactor + padding * 2}`\n    },\n    thumbnailPolygonPoints: function (map, maxHeight = 50) {\n      const maskExtent = this.maskExtent(map)\n      const maskDimensions = this.maskDimensions(map)\n      const scaleFactor = maxHeight / Math.max(...maskDimensions)\n\n      const points = map.pixelMask.map((point) => ([\n        (point[0] - maskExtent[0][0]) * scaleFactor,\n        (point[1] - maskExtent[1][0]) * scaleFactor\n      ]))\n\n      return points\n        .map((point) => point.join(',')).join(' ')\n    },\n    ...mapActions('maps', [\n      'removeMap',\n      'removeGcp'\n    ]),\n    ...mapActions('ui', [\n      'setActiveMapId'\n    ]),\n    mapClicked: function (mapId) {\n      this.setActiveMapId({ mapId })\n    }\n  },\n  computed: {\n    ...mapState({\n      activeMapId: (state) => state.ui.activeMapId,\n      maps: (state) => state.maps.maps\n    }),\n    source: function () {\n      return this.$options.name\n    }\n  }\n}\n</script>\n\n<style scoped>\nol.maps {\n  margin: 0;\n  padding: 0;\n  list-style-type: none;\n  font-size: 75%;\n}\n\nol li {\n  cursor: pointer;\n}\n\n.map {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.map .index {\n  display: flex;\n  align-items: center;\n}\n\n.thumbnail {\n  display: inline-block;\n  position: relative;\n  width: 50px;\n  height: 50px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n}\n\n.thumbnail > * {\n  position: absolute;\n}\n\n.thumbnail span {\n  padding: .1em;\n  background-color: rgba(255, 255, 255, 0.9);\n  text-shadow: 0 0 1em white;\n  border-radius: 50%;\n  width: 1.1em;\n  height: 1.1em;\n  text-align: center;\n  line-height: 1;\n}\n\n.thumbnail svg {\n  width: 50px;\n  height: 50px;\n}\n\n.thumbnail polygon {\n  fill: none;\n  stroke: black;\n  stroke-width: 1px;\n}\n\n.active .thumbnail polygon {\n  stroke-width: 3px;\n}\n\n.gcps {\n  list-style-type: none;\n  margin-left: 18px;\n}\n\n.gcp {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.gcp-data {\n  display: flex;\n  flex-direction: row;\n}\n\n.gcp-icon {\n  display: inline-block;\n  margin-right: 12px;\n}\n\n.gcp .circle {\n  display: inline-block;\n  width: 14px;\n  height: 14px;\n  border-radius: 999px;\n  background-color: red;\n}\n\n.gcp .index {\n  top: 0.5em;\n  position: relative;\n}\n\n.gcp .gcp-coordinates {\n  display: flex;\n  flex-direction: row;\n  font-family: monospace;\n}\n\n.gcp .gcp-image-coordinate {\n  width: 3.5em;\n}\n\n.gcp .gcp-world-coordinate {\n  width: 6em;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Maps.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Maps.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Maps.vue?vue&type=template&id=659b5317&scoped=true&\"\nimport script from \"./Maps.vue?vue&type=script&lang=js&\"\nexport * from \"./Maps.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Maps.vue?vue&type=style&index=0&id=659b5317&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"659b5317\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"drawer-content\"},[_c('pre',{directives:[{name:\"highlightjs\",rawName:\"v-highlightjs\",value:(_vm.annotationString),expression:\"annotationString\"}]},[_c('code',{staticClass:\"json\"})]),_c('div',{staticClass:\"block actions buttons\"},[_c('b-button',{attrs:{\"icon-left\":\"copy\"},on:{\"click\":_vm.copy}},[_vm._v(\"Copy\")]),_c('b-button',{attrs:{\"icon-left\":\"file-download\"},on:{\"click\":_vm.download}},[_vm._v(\"Download\")]),_c('a',{staticClass:\"button is-link\",attrs:{\"target\":\"_blank\",\"href\":(\"https://annotations.allmaps.org/images/\" + _vm.activeImageId),\"type\":\"button\"}},[_vm._m(0),_c('span',[_vm._v(\"Open in new tab\")])])],1)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',{staticClass:\"icon is-small\"},[_c('i',{staticClass:\"fas fa-external-link-alt\"})])}]\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"drawer-content\">\n    <pre v-highlightjs=\"annotationString\"><code class=\"json\"></code></pre>\n    <div class=\"block actions buttons\">\n      <b-button @click=\"copy\" icon-left=\"copy\">Copy</b-button>\n      <b-button @click=\"download\" icon-left=\"file-download\">Download</b-button>\n\n      <a target=\"_blank\" :href=\"`https://annotations.allmaps.org/images/${activeImageId}`\"\n        class=\"button is-link\" type=\"button\">\n        <span class=\"icon is-small\">\n          <i class=\"fas fa-external-link-alt\"></i>\n        </span>\n        <span>Open in new tab</span>\n      </a>\n\n\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters } from 'vuex'\n\nimport { generate } from '@allmaps/annotation'\n\nexport default {\n  name: 'Annotation',\n  computed: {\n    ...mapState({\n      activeImageId: (state) => state.ui.activeImageId,\n      maps: (state) => state.maps.maps\n    }),\n    ...mapGetters('ui', {\n      activeImage: 'activeImage'\n    }),\n    annotation: function () {\n      const maps = Object.values(this.maps)\n        .map((map) => {\n          return {\n            ...map,\n            pixelMask: [...map.pixelMask, map.pixelMask[0]],\n            gcps: Object.values(map.gcps),\n            image: this.getAnnotationImage(map, this.activeImage)\n          }\n        })\n\n      return generate(maps)\n    },\n    annotationString: function () {\n      return JSON.stringify(this.annotation, null, 2)\n    }\n  },\n  methods: {\n    getAnnotationImage: function (map, image) {\n      if (map.version === 1) {\n        return {\n          ...map.image,\n          dimensions: undefined,\n          width: image.width,\n          height: image.height,\n          quality: image.quality,\n          format: image.format,\n          version: image.version\n        }\n      } else {\n        return map\n      }\n    },\n    copy: function () {\n      navigator.clipboard.writeText(this.annotationString)\n\n      this.$buefy.toast.open({\n        message: 'Annotation copied to clipboard!',\n        type: 'is-success'\n      })\n    },\n    download: function () {\n      const blob = new Blob([this.annotationString], {type : 'application/json'})\n      const dataUrl = window.URL.createObjectURL(blob)\n\n      const a = document.createElement('a')\n      document.body.appendChild(a)\n      a.style = 'display: none'\n\n      a.href = dataUrl\n\n      // TODO: proper filename\n      // image.id\n      a.download = 'annotation.json'\n      a.click()\n      window.URL.revokeObjectURL(dataUrl)\n\n      this.$buefy.toast.open({\n        message: 'Annotation is downloading',\n        type: 'is-success'\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.drawer-content {\n  display: flex;\n  flex-direction: column;\n}\n\npre {\n  background-color: black;\n  margin: 0;\n  padding: 0;\n  white-space: pre-wrap;\n  border-radius: 0.5em;\n  /* height: 400px; */\n  overflow: auto;\n}\n\ncode {\n  height: 100%;\n  width: 100%;\n  padding: 0.5rem;\n}\n\n.actions {\n  flex-shrink: 0;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Annotation.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Annotation.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Annotation.vue?vue&type=template&id=27e1be1f&scoped=true&\"\nimport script from \"./Annotation.vue?vue&type=script&lang=js&\"\nexport * from \"./Annotation.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Annotation.vue?vue&type=style&index=0&id=27e1be1f&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"27e1be1f\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <footer class=\"padding\">\n    <!-- <div class=\"drawer box column is-three-quarters-mobile is-two-thirds-tablet is-half-desktop is-one-third-widescreen\"> -->\n    <div class=\"drawer box\">\n      <template v-if=\"drawerOpen\">\n        <Metadata v-if=\"drawerOpen === 'metadata'\" />\n        <Maps v-else-if=\"drawerOpen === 'maps'\" />\n        <Annotation v-else-if=\"drawerOpen === 'annotation'\" />\n        <hr />\n      </template>\n\n      <div class=\"base\">\n        <div>\n          <h3 class=\"label\">{{ label }}</h3>\n          <div class=\"select-image\">\n            <template v-if=\"activeImage && imageCount > 1\">\n              <span>\n                Image {{ activeImage.index + 1 }}/{{ imageCount }}\n              </span>\n              <div class=\"buttons prev-next-buttons\">\n                <b-button size=\"is-small\" icon-left=\"arrow-left\"\n                  :disabled=\"!activeImage.previousImageId\"\n                  tag=\"router-link\" type=\"is-link\" :to=\"{\n                  name: $route.name,\n                  query: {\n                    url: $route.query.url,\n                    image: activeImage.previousImageId\n                  }}\" />\n                <b-button size=\"is-small\" icon-left=\"arrow-right\"\n                  :disabled=\"!activeImage.nextImageId\"\n                  tag=\"router-link\" type=\"is-link\" :to=\"{\n                  name: $route.name,\n                  query: {\n                    url: $route.query.url,\n                    image: activeImage.nextImageId\n                  }}\" />\n              </div>\n            </template>\n          </div>\n        </div>\n        <div class=\"controls\">\n          <div class=\"buttons drawer-buttons\">\n            <b-button @click=\"toggleDrawer('metadata')\" v-if=\"hasMetadata\"\n              :active=\"drawerOpen === 'metadata'\" icon-right=\"info\" />\n            <b-button @click=\"toggleDrawer('maps')\"\n              :active=\"drawerOpen === 'maps'\" icon-right=\"list\" />\n            <b-button @click=\"toggleDrawer('annotation')\"\n              :active=\"drawerOpen === 'annotation'\" icon-right=\"code\" />\n            <!-- <b-button\n              icon-right=\"undo\" @click=\"undo\" />\n            <b-button\n              icon-right=\"redo\" @click=\"redo\" /> -->\n          </div>\n        </div>\n      </div>\n    </div>\n  </footer>\n</template>\n\n<script>\nimport { mapActions, mapGetters, mapState } from 'vuex'\n\nimport Metadata from './drawer/Metadata.vue'\nimport Maps from './drawer/Maps.vue'\nimport Annotation from './drawer/Annotation.vue'\n\nexport default {\n  name: 'Drawer',\n  components: {\n    Metadata,\n    Maps,\n    Annotation\n  },\n  methods: {\n    ...mapActions('ui', [\n      'toggleDrawer'\n    ]),\n    ...mapActions('maps', [\n      'undo',\n      'redo'\n    ])\n  },\n  computed: {\n    ...mapGetters('iiif', {\n      label: 'label',\n      metadata: 'metadata',\n      description: 'description',\n      imageCount: 'imageCount'\n    }),\n    ...mapGetters('ui', {\n      activeImage: 'activeImage'\n    }),\n    ...mapState({\n      drawerOpen: (state) => state.ui.drawerOpen\n    }),\n    hasMetadata: function () {\n      return this.label || this.metadata || this.description\n    }\n  }\n}\n</script>\n\n<style scoped>\nfooter {\n  position: absolute;\n  z-index: 35;\n  bottom: 0;\n  width: 100%;\n\n  display: flex;\n  justify-content: flex-end;\n\n  pointer-events: none;\n}\n\n.drawer {\n  pointer-events: all;\n  background-color: white;\n}\n\n.base {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.controls {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.prev-next-buttons {\n  display: inline-block;\n}\n\n.drawer-buttons {\n  flex-wrap: nowrap;\n}\n\n.drawer-buttons button {\n  border-radius: 999px;\n}\n\n.label {\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.drawer-content {\n  max-height: 300px;\n  overflow-y: auto;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Drawer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Drawer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Drawer.vue?vue&type=template&id=524c1226&scoped=true&\"\nimport script from \"./Drawer.vue?vue&type=script&lang=js&\"\nexport * from \"./Drawer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Drawer.vue?vue&type=style&index=0&id=524c1226&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"524c1226\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',[_c('b-sidebar',{attrs:{\"type\":\"is-light\",\"fullheight\":true,\"overlay\":true,\"right\":true},model:{value:(_vm.open),callback:function ($$v) {_vm.open=$$v},expression:\"open\"}},[_c('div',{staticClass:\"padding\"},[_c('div',{staticClass:\"sidebar-title\"},[_c('div',[_c('img',{attrs:{\"alt\":\"Allmaps\",\"src\":\"https://raw.githubusercontent.com/allmaps/style/master/images/allmaps-logo.svg\"}}),_c('h2',[_vm._v(\"Editor\")])]),_c('b-button',{staticClass:\"is-light\",attrs:{\"icon-right\":\"times\"},on:{\"click\":function($event){_vm.open = false}}})],1),_c('div',{staticClass:\"container content\"},[_c('p',[_c('router-link',{attrs:{\"to\":{ name: 'home' }}},[_vm._v(\"Open new IIIF URL\")])],1),_c('h4',[_vm._v(\"Keyboard shortcuts\")]),_c('dl',{staticClass:\"shortcuts\"},_vm._l((_vm.shortcuts),function(shortcut,index){return _c('div',{key:index,staticClass:\"shortcut block\"},[_c('dt',[_vm._v(_vm._s(shortcut.label))]),_c('dd',{staticClass:\"key\"},[_vm._v(_vm._s(shortcut.key))])])}),0)])])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <section>\n    <b-sidebar type=\"is-light\" :fullheight=\"true\"\n      :overlay=\"true\" :right=\"true\" v-model=\"open\">\n      <div class=\"padding\">\n        <div class=\"sidebar-title\">\n          <div>\n            <img alt=\"Allmaps\"\n              src=\"https://raw.githubusercontent.com/allmaps/style/master/images/allmaps-logo.svg\" />\n            <h2>Editor</h2>\n          </div>\n          <b-button @click=\"open = false\"\n            class=\"is-light\" icon-right=\"times\" />\n        </div>\n        <div class=\"container content\">\n          <p>\n           <router-link :to=\"{ name: 'home' }\">Open new IIIF URL</router-link>\n          </p>\n          <h4>Keyboard shortcuts</h4>\n\n          <dl class=\"shortcuts\">\n            <div v-for=\"(shortcut, index) of shortcuts\" :key=\"index\" class=\"shortcut block\">\n              <dt>{{ shortcut.label }}</dt>\n              <dd class=\"key\">{{ shortcut.key }}</dd>\n            </div>\n          </dl>\n        </div>\n        <!-- <ul>\n          <li>About</li>\n          <li>Open source</li>\n          <li>Explore map collections</li>\n          <li>Terms of use</li>\n        </ul> -->\n      </div>\n    </b-sidebar>\n  </section>\n</template>\n\n<script>\nimport { mapActions } from 'vuex'\n\nexport default {\n  name: 'Sidebar',\n  data: function () {\n    return {\n      shortcuts: [\n        { label: 'Previous image', key: '[' },\n        { label: 'Next image', key: ']' },\n\n        { label: 'Previous map', key: '{' },\n        { label: 'Next map', key: '}' },\n\n        { label: 'Open new IIIF URL', key: '0' },\n        { label: 'Collection view', key: '1' },\n        { label: 'Mask view', key: '2' },\n        { label: 'Georeference view', key: '3' },\n        { label: 'Results view', key: '4' },\n\n        { label: 'Open metadata drawer', key: 'I' },\n        { label: 'Open maps & GCP drawer', key: 'M' },\n        { label: 'Open annotation drawer', key: 'A' },\n\n        { label: 'Close dialog or sidebar', key: 'esc' }\n      ]\n    }\n  },\n  methods: {\n    ...mapActions('ui', [\n      'setSidebarOpen'\n    ])\n  },\n  computed: {\n    open: {\n      get () {\n        return this.$store.state.ui.sidebarOpen\n      },\n      set (open) {\n        this.setSidebarOpen({ open })\n      },\n    }\n  }\n}\n</script>\n\n<style scoped>\n.sidebar-title {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.sidebar-title img {\n  width: 1em;\n}\n\n.sidebar-title h2 {\n  padding-left: 0.25em;\n  display: inline-block;\n}\n\n.shortcuts {\n  font-size: 75%;\n}\n\n.shortcut {\n  display: flex;\n  justify-content: space-between;\n}\n\n.key {\n  font-family: monospace;\n  box-shadow: 0 0 0 1px #dedede,1px 1px 0 1px #e8e8e8;\n  padding: 0 0.25em;\n  min-width: 1.5em;\n  font-weight: bold;\n  text-align: center;\n  margin-left: 1em;\n  display: inline-block;\n  border-radius: 2px;\n  white-space: nowrap;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Sidebar.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Sidebar.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Sidebar.vue?vue&type=template&id=121bdc8a&scoped=true&\"\nimport script from \"./Sidebar.vue?vue&type=script&lang=js&\"\nexport * from \"./Sidebar.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Sidebar.vue?vue&type=style&index=0&id=121bdc8a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"121bdc8a\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container below-header content section\"},[_c('p',{staticClass:\"block\"},[_vm._v(\" Start georeferencing a map by typing its IIIF Manifest or Image URL in the input box: \")]),_c('form',{staticClass:\"block\"},[_c('b-field',[_c('b-input',{staticClass:\"is-link\",attrs:{\"placeholder\":\"IIIF manifest or image URL\",\"expanded\":\"\",\"type\":\"search\"},model:{value:(_vm.inputUrl),callback:function ($$v) {_vm.inputUrl=$$v},expression:\"inputUrl\"}}),_c('p',{staticClass:\"control\"},[_c('b-button',{attrs:{\"native-type\":\"submit\",\"type\":\"is-primary\",\"label\":\"Load\"},on:{\"click\":_vm.handleSubmit}})],1)],1)],1),_vm._m(0)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',{staticClass:\"block\"},[_vm._v(\" For examples of map collections that are accessible with IIIF and URLs you can use, see \"),_c('a',{attrs:{\"href\":\"https://next.observablehq.com/d/8c38533260c50483?collection=@bertspaan/iiif-maps\"}},[_vm._v(\"this Observable notebook\")]),_vm._v(\". \")])}]\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"container below-header content section\">\n    <p class=\"block\">\n      Start georeferencing a map by typing its IIIF Manifest or Image URL in the input box:\n    </p>\n\n    <form class=\"block\">\n      <b-field>\n        <b-input placeholder=\"IIIF manifest or image URL\" expanded\n          v-model=\"inputUrl\" class=\"is-link\" type=\"search\">\n        </b-input>\n        <p class=\"control\">\n          <b-button @click=\"handleSubmit\" native-type=\"submit\"\n            type=\"is-primary\" label=\"Load\" />\n        </p>\n      </b-field>\n    </form>\n\n    <p class=\"block\">\n      For examples of map collections that are accessible with IIIF and URLs you can use, see <a href=\"https://next.observablehq.com/d/8c38533260c50483?collection=@bertspaan/iiif-maps\">this Observable notebook</a>.\n    </p>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'Home',\n  props: {\n    images: Object\n  },\n  data () {\n    return {\n      inputUrl: this.$route.query.url\n    }\n  },\n  computed: {\n  },\n  watch: {\n    '$route.query.url': function () {\n      this.inputUrl = this.$route.query.url\n    }\n  },\n  methods: {\n    handleSubmit () {\n      this.$router.push({ name: 'collection', query: {\n        url: this.inputUrl\n      }})\n    }\n  }\n}\n</script>\n\n<style scoped>\n.text {\n  width: 100%;\n  position: relative;\n}\n\n.text > *:first-child {\n  margin-top: 0;\n}\n\n.images {\n  margin: 0;\n  padding: 0;\n  list-style-type: none;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  grid-gap: 10px;\n}\n\n.images li {\n  position: relative;\n  box-sizing: border-box;\n  border-width: 3px;\n  border-color: white;\n  border-style: solid;\n  transition: border-color 0.08s;\n}\n\n.images li::before {\n  content: \"\";\n  padding-bottom: 100%;\n  display: inline-block;\n  vertical-align: top;\n}\n\n.images li.active {\n  border-color: #C552B5;\n  border-style: solid;\n  border-width: 3px;\n}\n\n.images li a {\n  width: 100%;\n  height: 100%;\n}\n\n.images li img.image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.icons {\n  position: absolute;\n  bottom: 0;\n  height: 2rem;\n  padding: 2px;\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-end;\n}\n\n.icons img {\n  width: 32px;\n  opacity: 0.15;\n}\n\n.icons img.present {\n  opacity: 1;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=3aab7ea2&scoped=true&\"\nimport script from \"./Home.vue?vue&type=script&lang=js&\"\nexport * from \"./Home.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Home.vue?vue&type=style&index=0&id=3aab7ea2&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3aab7ea2\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"background\"},[_c('section',{staticClass:\"container below-header\"},[_c('ol',{staticClass:\"images\"},_vm._l((_vm.imagesById),function(image,imageId){return _c('li',{key:imageId,class:{\n          active: _vm.activeImageId === imageId\n        }},[_c('router-link',{attrs:{\"to\":{\n          name: 'collection',\n          query: {\n            image: imageId,\n            url: _vm.$route.query.url\n          }}}},[(!image.stub)?[(!image.stub)?_c('Thumbnail',{attrs:{\"image\":image}}):_vm._e()]:[_c('div',[_c('b-icon',{attrs:{\"pack\":\"fas\",\"icon\":\"sync-alt\",\"size\":\"is-large\",\"custom-class\":\"fa-spin\"}})],1)]],2),_c('div',{staticClass:\"icons\"})],1)}),0)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.singleImage)?_c('img',{staticClass:\"single\",attrs:{\"src\":_vm.getImageUrl(_vm.image, _vm.thumbnail)}}):_c('div',{staticClass:\"tiled\",style:({\n  width: ((_vm.tilesWidth * _vm.scale) + \"px\"),\n  height: ((_vm.tilesHeight * _vm.scale) + \"px\"),\n  gridTemplateRows: (\"repeat(\" + _vm.rowCount + \", auto)\"),\n  gridTemplateColumns: (\"repeat(\" + _vm.columnCount + \", auto)\")\n})},[_vm._l((_vm.thumbnail),function(row,rowIndex){return [_vm._l((row),function(cell,columnIndex){return [_c('img',{key:(columnIndex + \",\" + rowIndex),style:({\n          width: ((cell.size.width * _vm.scale) + \"px\")\n        }),attrs:{\"src\":_vm.getImageUrl(_vm.image, _vm.removeHeight(cell))}})]})]})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <img v-if=\"singleImage\" class=\"single\" :src=\"getImageUrl(image, thumbnail)\"/>\n  <div v-else class=\"tiled\" :style=\"{\n    width: `${tilesWidth * scale}px`,\n    height: `${tilesHeight * scale}px`,\n    gridTemplateRows: `repeat(${rowCount}, auto)`,\n    gridTemplateColumns: `repeat(${columnCount}, auto)`\n  }\">\n    <template v-for=\"(row, rowIndex) in thumbnail\">\n      <template v-for=\"(cell, columnIndex) in row\">\n        <img :src=\"getImageUrl(image, removeHeight(cell))\"\n          :style=\"{\n            width: `${cell.size.width * scale}px`\n          }\"\n          :key=\"`${columnIndex},${rowIndex}`\" />\n      </template>\n    </template>\n  </div>\n</template>\n\n<script>\n\nimport { getThumbnail, getImageUrl } from '@allmaps/iiif-parser'\n\nexport default {\n  name: 'Thumbnail',\n  props: {\n    image: Object,\n    width: {\n      type: Number,\n      default: 200\n    }\n  },\n  computed: {\n    singleImage: function () {\n      return !Array.isArray(this.thumbnail)\n    },\n    thumbnail: function () {\n      return getThumbnail(this.image, this.width)\n    },\n    rowCount: function () {\n      return this.thumbnail.length\n    },\n    columnCount: function () {\n      const firstRow = this.thumbnail[0]\n      return firstRow.length\n    },\n    tilesWidth: function () {\n      const firstRow = this.thumbnail[0]\n      return firstRow.reduce((acc, row) => acc + row.size.width, 0)\n    },\n    tilesHeight: function () {\n      return this.thumbnail.reduce((acc, cells) => acc + cells[0].size.height, 0)\n    },\n    scale: function () {\n      return this.width / Math.max(this.tilesWidth, this.tilesHeight)\n    }\n  },\n  methods: {\n    getImageUrl,\n    getThumbnail,\n    removeHeight: function ({ region, size }) {\n      return {\n        region,\n        size: {\n          width: size.width\n        }\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\nimg.single {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.tiled {\n  display: grid;\n}\n\n/*\n.images li img.image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  max-height: 100%;\n  min-width: 100%;\n  object-fit: cover;\n  vertical-align: bottom;\n} */\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Thumbnail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Thumbnail.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Thumbnail.vue?vue&type=template&id=bbefe63c&scoped=true&\"\nimport script from \"./Thumbnail.vue?vue&type=script&lang=js&\"\nexport * from \"./Thumbnail.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Thumbnail.vue?vue&type=style&index=0&id=bbefe63c&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bbefe63c\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div class=\"background\">\n    <section class=\"container below-header\">\n      <ol class=\"images\">\n        <li v-for=\"(image, imageId) in imagesById\" :key=\"imageId\"\n          :class=\"{\n            active: activeImageId === imageId\n          }\">\n          <router-link :to=\"{\n            name: 'collection',\n            query: {\n              image: imageId,\n              url: $route.query.url\n            }}\">\n            <template v-if=\"!image.stub\">\n              <Thumbnail v-if=\"!image.stub\" :image=\"image\"  />\n              <!-- TODO: add label, or index -->\n              <!-- <span v-if=\"image.label\">{{ image.label }}</span> -->\n            </template>\n            <template v-else>\n              <div>\n                <b-icon\n                  pack=\"fas\"\n                  icon=\"sync-alt\"\n                  size=\"is-large\"\n                  custom-class=\"fa-spin\" />\n              </div>\n            </template>\n          </router-link>\n          <div class=\"icons\">\n            <!-- <img :class=\"{present: hasGcps(id)}\" src=\"../assets/icon-georeferenced.svg\" /> -->\n            <!-- <img :class=\"{present: hasPixelMask(id)}\" src=\"../assets/icon-masked.svg\" /> -->\n          </div>\n        </li>\n      </ol>\n    </section>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\n\nimport Thumbnail from './Thumbnail.vue'\n\nexport default {\n  name: 'Collection',\n  components: {\n    Thumbnail\n  },\n  computed: {\n    ...mapState({\n      imagesById: (state) => state.iiif.imagesById,\n      maps: (state) => state.maps.maps,\n      activeImageId: (state) => state.ui.activeImageId\n    })\n  },\n  methods: {\n    handleSubmit () {\n      this.$router.push({ name: this.$route.name, query: {\n        url: this.inputUrl\n      }})\n    },\n    mapsForImage: function (imageId) {\n      return Object.values(this.maps)\n        .filter((map) => map.imageId === imageId)\n    },\n    hasGcps: function (imageId) {\n      const maps = this.mapsForImage(imageId)\n      return maps.some((map) => map.gcps && Object.keys(map.gcps).length)\n    },\n    hasPixelMask: function (imageId) {\n      const maps = this.mapsForImage(imageId)\n      return maps.some((map) => map.pixelMask && map.pixelMask.length)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.background {\n  background-color: var(--blue-4);\n}\n\n.images {\n  margin: 10px;\n  padding: 0;\n  list-style-type: none;\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.images::after {\n  content: \"\";\n  flex-grow: 10;\n}\n\n.images li {\n  position: relative;\n  margin: 10px;\n\n  width: 200px;\n  height: 200px;\n  max-width: 200px;\n\n  flex-grow: 1;\n  box-sizing: border-box;\n  border-width: 3px;\n  border-color: white;\n  border-style: solid;\n  transition: border-color 0.08s;\n}\n\n/* li:last-child {\n  flex-grow: 10;\n} */\n\n/* .images li::before {\n  content: \"\";\n  padding-bottom: 100%;\n  display: inline-block;\n  vertical-align: top;\n} */\n\n.images li.active {\n  border-color: #C552B5;\n  border-style: solid;\n  border-width: 3px;\n}\n\n.images li a {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.icons {\n  position: absolute;\n  bottom: 0;\n  height: 2rem;\n  padding: 2px;\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-end;\n}\n\n.icons img {\n  width: 32px;\n  opacity: 0.15;\n}\n\n.icons img.present {\n  opacity: 1;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Collection.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Collection.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Collection.vue?vue&type=template&id=f6a0d8ce&scoped=true&\"\nimport script from \"./Collection.vue?vue&type=script&lang=js&\"\nexport * from \"./Collection.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Collection.vue?vue&type=style&index=0&id=f6a0d8ce&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f6a0d8ce\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panes\"},[_c('div',{staticClass:\"iiif zoom-controls-bottom-left\",attrs:{\"id\":\"iiif\"}}),_c('div',{staticClass:\"map zoom-controls-bottom-right\",attrs:{\"id\":\"map\"}})])}]\n\nexport { render, staticRenderFns }","import { shiftKeyOnly, singleClick } from 'ol/events/condition'\n\nexport function deleteCondition (event) {\n  return shiftKeyOnly(event) &&\n    singleClick(event)\n}\n","import { createRandomId } from '@allmaps/id'\n\nexport async function createFullImageMap (image) {\n  const mapId = await createRandomId()\n\n  const pixelMask = [\n    [0, 0],\n    [0, image.height],\n    [image.width, image.height],\n    [image.width, 0]\n  ]\n\n  return {\n    id: mapId,\n    image: {\n      id: image.id,\n      uri: image.uri,\n      width: image.width,\n      height: image.height,\n      version: image.version,\n      quality: image.quality,\n      format: image.format\n    },\n    pixelMask\n  }\n}\n","<template>\n  <div class=\"panes\">\n    <div id=\"iiif\" class=\"iiif zoom-controls-bottom-left\"></div>\n    <div id=\"map\" class=\"map zoom-controls-bottom-right\"></div>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapActions, mapGetters } from 'vuex'\n\nimport Map from 'ol/Map'\nimport Feature from 'ol/Feature'\nimport View from 'ol/View'\nimport { Tile as TileLayer, Vector as VectorLayer } from 'ol/layer'\nimport { Draw, Modify } from 'ol/interaction'\nimport { Point } from 'ol/geom'\nimport { GeoJSON } from 'ol/format'\nimport { Vector as VectorSource } from 'ol/source'\nimport Zoom from 'ol/control/Zoom'\nimport XYZ from 'ol/source/XYZ'\nimport { Circle as CircleStyle, Fill, Stroke, Style, Text } from 'ol/style'\nimport IIIF from 'ol/source/IIIF'\nimport IIIFInfo from 'ol/format/IIIFInfo'\nimport { fromLonLat } from 'ol/proj'\n\nimport { createRandomId } from '@allmaps/id'\n\nimport { deleteCondition } from '../lib/openlayers'\nimport { createFullImageMap } from '../lib/map'\nimport { round } from '../lib/functions'\n\nexport default {\n  name: 'Georeference',\n  data () {\n    return {\n      singleIiifFeatures: [],\n      singleMapFeatures: [],\n\n      dimensions: undefined\n    }\n  },\n  watch: {\n    activeMapId: function () {\n      this.iiifSource.changed()\n      this.initalizeGCPs(this.activeMap)\n    },\n    activeImage: function () {\n      this.updateImage(this.activeImage)\n      this.initalizeGCPs(this.activeMap)\n    }\n  },\n  methods: {\n    ...mapActions('maps', [\n      'insertMap',\n      'insertGcp',\n      'replaceGcp',\n      'removeGcp'\n    ]),\n    onStoreMutation: function (mutation) {\n      if (mutation.payload.source === this.source) {\n        return\n      }\n\n      const mapId = mutation.payload.mapId\n\n      if (mutation.type === 'maps/removeMap') {\n        this.clearGcps()\n        return\n      } else if (this.activeMapId !== mapId) {\n        return\n      }\n\n      const gcpId = mutation.payload.gcpId\n      const gcp = mutation.payload.gcp\n\n      if (mutation.type === 'maps/removeGcp') {\n        const iiifFeature = this.iiifSource.getFeatureById(gcpId)\n        const mapFeature = this.mapSource.getFeatureById(gcpId)\n\n        if (iiifFeature) {\n          this.iiifSource.removeFeature(iiifFeature)\n        }\n\n        if (mapFeature) {\n          this.mapSource.removeFeature(mapFeature)\n        }\n      } else if (mutation.type === 'maps/insertGcp' || mutation.type === 'maps/replaceGcp') {\n        const iiifFeature = this.iiifSource.getFeatureById(gcpId)\n        const mapFeature = this.mapSource.getFeatureById(gcpId)\n\n        if (gcp.image) {\n          const coordinates = gcp.image\n          if (iiifFeature) {\n            iiifFeature.getGeometry().setCoordinates([\n              coordinates[0],\n              -coordinates[1]\n            ])\n          } else {\n            const index = this.iiifSource.getFeatures().length\n\n            const iiifFeature = new Feature({\n              index,\n              geometry: new Point([\n                coordinates[0],\n                -coordinates[1]\n              ])\n            })\n\n            iiifFeature.setId(gcp.id)\n\n            if (!gcp.world) {\n              this.singleIiifFeatures.push(iiifFeature)\n            }\n\n            this.iiifSource.addFeature(iiifFeature)\n          }\n        }\n\n        if (gcp.world) {\n          const coordinates = gcp.world\n          if (mapFeature) {\n            mapFeature.getGeometry().setCoordinates(fromLonLat(coordinates))\n          } else {\n            const index = this.mapSource.getFeatures().length\n\n            const mapFeature = (new GeoJSON()).readFeature({\n              type: 'Feature',\n              id: gcp.id,\n              properties: {\n                index\n              },\n              geometry: {\n                type: 'Point',\n                coordinates\n              }\n            }, { featureProjection: 'EPSG:3857' })\n\n            mapFeature.setId(gcp.id)\n\n            if (!gcp.image) {\n              this.singleMapFeatures.push(mapFeature)\n            }\n\n            this.mapSource.addFeature(mapFeature)\n          }\n        }\n      }\n    },\n    // prerender: function (event) {\n    //   if (this.maps.length === 0) {\n    //     return\n    //   }\n\n    //   const ctx = event.context\n    //   ctx.save()\n    //   ctx.beginPath()\n\n    //   const contextMask = this.selectedMap.pixelMask\n    //     .map((point) => this.iiifOl.getPixelFromCoordinate([point[0], -point[1]]))\n\n    //   ctx.moveTo(contextMask[0][0], contextMask[0][1])\n    //   contextMask.slice(1).forEach((point) => {\n    //     ctx.lineTo(point[0], point[1])\n    //   })\n\n    //   ctx.closePath()\n    //   ctx.clip()\n    // },\n    // postrender: function (event) {\n    //   const ctx = event.context\n    //   ctx.restore()\n    // },\n    onResize: function () {\n      if (this.iiifOl && this.mapOl) {\n        this.iiifOl.updateSize()\n        this.mapOl.updateSize()\n      }\n    },\n    pointDifference: function () {\n      const iiifFeatures = this.iiifSource.getFeatures()\n      const mapFeatures = this.mapSource.getFeatures()\n\n      return iiifFeatures.length - mapFeatures.length\n    },\n    gcpFromGcpId: function (gcpId) {\n      const iiifFeature = this.iiifSource.getFeatureById(gcpId)\n      const mapFeature = this.mapSource.getFeatureById(gcpId)\n\n      let iiifPoint\n      if (iiifFeature) {\n        iiifPoint = this.iiifFeatureToPoint(iiifFeature)\n      }\n\n      let mapPoint\n      if (mapFeature) {\n        mapPoint = this.mapFeatureToPoint(mapFeature)\n      }\n\n      return {\n        id: gcpId,\n        image: iiifPoint,\n        world: mapPoint\n      }\n    },\n    clearGcps: function () {\n      this.mapSource.clear()\n      this.iiifSource.clear()\n\n      this.singleIiifFeatures = []\n      this.singleMapFeatures = []\n    },\n    initalizeGCPs: function (map) {\n      this.clearGcps()\n\n      const gcps = (map && Object.values(map.gcps)) || []\n\n      if (!gcps || gcps.length === 0) {\n        return\n      }\n\n      const iiifFeatures = gcps\n        .map((gcp, index) => {\n          const coordinates = gcp.image\n          if (coordinates) {\n            const feature = new Feature({\n              index,\n              geometry: new Point([\n                coordinates[0],\n                -coordinates[1]\n              ])\n            })\n\n            feature.setId(gcp.id)\n\n            if (!gcp.world) {\n              this.singleIiifFeatures.push(feature)\n            }\n\n            return feature\n          }\n        })\n        .filter((feature) => feature)\n\n      const mapFeatures = gcps\n        .map((gcp, index) => {\n          const coordinates = gcp.world\n\n          if (coordinates) {\n            const feature = (new GeoJSON()).readFeature({\n              type: 'Feature',\n              id: gcp.id,\n              properties: {\n                index\n              },\n              geometry: {\n                type: 'Point',\n                coordinates\n              }\n            }, { featureProjection: 'EPSG:3857' })\n\n            feature.setId(gcp.id)\n\n            if (!gcp.image) {\n              this.singleMapFeatures.push(feature)\n            }\n\n            return feature\n          }\n        })\n        .filter((feature) => feature)\n\n      this.iiifSource.addFeatures(iiifFeatures)\n      this.mapSource.addFeatures(mapFeatures)\n\n      if (mapFeatures.length > 0) {\n        const extent = this.mapSource.getExtent()\n        this.mapOl.getView().fit(extent, {\n          padding: [25, 25, 25, 25],\n          maxZoom: 18\n        })\n      }\n    },\n    iiifFeatureToPoint: function (feature) {\n      const coordinate = feature.getGeometry().getCoordinates()\n      return [\n        Math.round(coordinate[0]),\n        Math.round(-coordinate[1])\n      ]\n    },\n    mapFeatureToPoint: function (feature) {\n      const geometry = feature.getGeometry().clone()\n      geometry.transform('EPSG:3857', 'EPSG:4326')\n\n      // 7 decimal places should be enough...\n      // See https://gis.stackexchange.com/questions/8650/measuring-accuracy-of-latitude-and-longitude\n      return geometry.getCoordinates()\n        .map((coordinate) => round(coordinate, 7))\n    },\n    onEdited: async function (event) {\n      if (event.type === 'addfeature') {\n        const feature = event.feature\n\n        if (feature.getId()) {\n          return\n        }\n\n        let gcpId\n        let newGcpId\n\n        const pointDifference = this.pointDifference()\n        if ((pointDifference > 0 && event.target === this.iiifSource) ||\n          (pointDifference < 0 && event.target === this.mapSource)) {\n          gcpId = await createRandomId()\n          newGcpId = true\n\n          if (event.target === this.iiifSource) {\n            this.singleIiifFeatures.push(feature)\n          } else {\n            this.singleMapFeatures.push(feature)\n          }\n        } else {\n          if (event.target === this.iiifSource) {\n            const matchingMapFeature = this.singleMapFeatures.shift()\n            gcpId = matchingMapFeature.getId()\n          } else {\n            const matchingIiifFeature = this.singleIiifFeatures.shift()\n            gcpId = matchingIiifFeature.getId()\n          }\n        }\n\n        feature.setId(gcpId)\n\n        const properties = feature.getProperties()\n\n        let index\n        if (event.target === this.iiifSource) {\n          index = this.iiifSource.getFeatures().length - 1\n        } else {\n          index = this.mapSource.getFeatures().length - 1\n        }\n\n        feature.setProperties({\n          index\n        })\n\n        const gcp = this.gcpFromGcpId(gcpId)\n\n        if (this.activeMapId) {\n          const mapId = this.activeMapId\n\n          if (newGcpId) {\n            this.insertGcp({ mapId, gcpId, gcp, source: this.source })\n          } else {\n            this.replaceGcp({ mapId, gcpId, gcp, source: this.source })\n          }\n        } else {\n          const map = await createFullImageMap(this.activeImage)\n          const { id: mapId, image, pixelMask } = map\n\n          const gcps = {\n            [gcpId]: gcp\n          }\n\n          this.insertMap({ mapId, image, pixelMask, gcps, source: this.source })\n        }\n      } else if (event.type === 'modifyend') {\n        const mapId = this.activeMapId\n\n        const feature = event.features.item(0)\n        const gcpId = feature.getId()\n\n        if (!gcpId) {\n          console.error('GCP without ID encountered')\n        } else {\n          const gcp = this.gcpFromGcpId(gcpId)\n          this.replaceGcp({ mapId, gcpId, gcp, source: this.source })\n        }\n      }\n\n      // const iiifFeatures = this.iiifVector.getSource().getFeatures()\n      // const mapFeatures = this.mapVector.getSource().getFeatures()\n\n      // if (iiifFeatures.length) {\n      //   const iiifPoints = iiifFeatures\n      //     .map((feature) => {\n      //       const coordinate = feature.getGeometry().getCoordinates()\n      //       return [\n      //         Math.round(coordinate[0]),\n      //         Math.round(-coordinate[1])\n      //       ]\n      //     })\n\n      //   this.iiifPoints = iiifPoints\n      // }\n\n      // if (mapFeatures.length) {\n      //   const mapPoints = mapFeatures\n      //     .map((feature) => {\n      //       const geometry = feature.getGeometry().clone()\n      //       geometry.transform('EPSG:3857', 'EPSG:4326')\n      //       return geometry.getCoordinates()\n      //         .map((coordinate) => round(coordinate))\n      //     })\n\n      //   this.mapPoints = mapPoints\n      // }\n\n      // if (this.pointDifference() === 0) {\n      //   const gcps = this.iiifPoints.map((iiifPoint, index) => ({\n      //     image: iiifPoint,\n      //     world: this.mapPoints[index]\n      //   }))\n\n      //   if (this.activeMapId) {\n\n      //   } else {\n\n      //   }\n\n      //   const imageId = this.image.id\n      //   const imageDimensions = [\n      //     this.image.width,\n      //     this.image.height\n      //   ]\n\n      //   const mapId = this.activeMapId || await createRandomId()\n\n      //   let pixelMask\n      //   if (this.activeMap && this.activeMap.pixelMask && this.activeMap.pixelMask.length) {\n      //     pixelMask = this.activeMap.pixelMask\n      //   } else {\n      //     pixelMask = [\n      //       [0, 0],\n      //       [0, imageDimensions[1]],\n      //       imageDimensions,\n      //       [imageDimensions[0], 0],\n      //       [0, 0]\n      //     ]\n      //   }\n\n      //   const map = {\n      //     id: mapId,\n      //     gcps,\n      //     imageId,\n      //     pixelMask\n      //   }\n\n      //   if (this.activeMapId) {\n      //     this.insertMap(map)\n      //   } else {\n      //     this.addMap(map)\n      //   }\n      // }\n    },\n    updateImage: function (image) {\n      if (!image || image.stub) {\n        return\n      }\n\n      const options = new IIIFInfo(image.sourceData).getTileSourceOptions()\n      if (options === undefined || options.version === undefined) {\n        throw new Error('Data seems to be no valid IIIF image information.')\n      }\n\n      options.zDirection = -1\n      const iiifTileSource = new IIIF(options)\n      this.iiifLayer.setSource(iiifTileSource)\n\n      const extent = iiifTileSource.getTileGrid().getExtent()\n\n      this.dimensions = [extent[2], -extent[1]]\n\n      this.iiifOl.setView(new View({\n        enableRotation: false,\n        resolutions: iiifTileSource.getTileGrid().getResolutions(),\n        extent,\n        constrainOnlyCenter: true\n      }))\n\n      this.iiifOl.getView().fit(iiifTileSource.getTileGrid().getExtent(), {\n        // TODO: move to settings file\n        padding: [90, 10, 90, 10]\n      })\n    },\n    gcpStyle: function (feature) {\n      return new Style({\n        stroke: new Stroke({\n          color: '#E10800',\n          width: 3\n        }),\n        image: new CircleStyle({\n          radius: 7,\n          fill: new Fill({\n            color: '#E10800'\n          })\n        }),\n        text: this.gcpTextStyle(feature)\n      })\n    },\n    gcpTextStyle: function (feature) {\n      return new Text({\n        scale: 1.5,\n        text: this.gcpLabel(feature),\n        fill: new Fill({color: '#000'}),\n        stroke: new Stroke({color: '#fff', width: 2}),\n        offsetX: 14,\n        offsetY: 14\n      })\n    },\n    gcpLabel: function (feature) {\n      const properties = feature.getProperties()\n      return String(properties.index + 1)\n    }\n  },\n  computed: {\n    ...mapState({\n      activeMapId: (state) => state.ui.activeMapId,\n      maps: (state) => state.maps.maps\n    }),\n    ...mapGetters('maps', {\n      activeMap: 'activeMap'\n    }),\n    ...mapGetters('ui', {\n      activeImage: 'activeImage'\n    }),\n    source: function () {\n      return this.$options.name\n    }\n  },\n  mounted: function () {\n    this.iiifLayer = new TileLayer()\n    this.iiifSource = new VectorSource()\n\n    this.iiifVector = new VectorLayer({\n      source: this.iiifSource,\n      style: this.gcpStyle\n    })\n\n    this.iiifOl = new Map({\n      layers: [this.iiifLayer, this.iiifVector],\n      target: 'iiif'\n    })\n\n    const tileSources = [\n      {\n        url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}',\n        attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community'\n      },\n      {\n        url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}',\n        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012'\n      },\n      {\n        url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\n        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'\n      }\n    ]\n\n    this.mapLayer = new TileLayer({\n      source: new XYZ({\n        // TODO: move to config\n        url: tileSources[0].url\n      })\n    })\n    this.mapSource = new VectorSource()\n\n    this.mapVector = new VectorLayer({\n      source: this.mapSource,\n      style: this.gcpStyle\n    })\n\n    this.mapOl = new Map({\n      layers: [this.mapLayer, this.mapVector],\n      controls: [\n        new Zoom()\n      ],\n      target: 'map',\n      view: new View({\n        enableRotation: false,\n        center: fromLonLat([0, 0]),\n        zoom: 2\n      })\n    })\n\n    this.iiifModify = new Modify({\n      source: this.iiifSource,\n      deleteCondition\n    })\n\n    this.mapModify = new Modify({\n      source: this.mapSource,\n      deleteCondition\n    })\n\n    this.iiifOl.addInteraction(this.iiifModify)\n    this.mapOl.addInteraction(this.mapModify)\n\n    const iiifDraw = new Draw({\n      source: this.iiifSource,\n      type: 'Point'\n    })\n\n    const mapDraw = new Draw({\n      source: this.mapSource,\n      type: 'Point'\n    })\n\n    this.iiifOl.addInteraction(iiifDraw)\n    this.mapOl.addInteraction(mapDraw)\n\n    this.iiifSource.on('addfeature', this.onEdited)\n    this.iiifModify.on('modifyend', this.onEdited)\n\n    this.mapSource.on('addfeature', this.onEdited)\n    this.mapModify.on('modifyend', this.onEdited)\n\n    // this.iiifLayer.on('prerender', this.prerender)\n    // this.iiifLayer.on('postrender', this.postrender)\n\n    this.storeUnsubscribe = this.$store.subscribe(this.onStoreMutation)\n\n    this.updateImage(this.activeImage)\n    this.initalizeGCPs(this.activeMap)\n  },\n  beforeDestroy: function () {\n    this.iiifSource.un('addfeature', this.onEdited)\n    this.iiifModify.un('modifyend', this.onEdited)\n\n    this.mapSource.un('addfeature', this.onEdited)\n    this.mapModify.un('modifyend', this.onEdited)\n\n    // this.iiifLayer.un('prerender', this.prerender)\n    // this.iiifLayer.un('postrender', this.postrender)\n\n    this.storeUnsubscribe()\n  }\n}\n</script>\n\n<style scoped>\n.panes {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n  height: 100%;\n  background-color: var(--green-4);\n}\n\n.panes > * {\n  width: 100%;\n  box-sizing: border-box;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Georeference.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Georeference.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Georeference.vue?vue&type=template&id=836ffa9e&scoped=true&\"\nimport script from \"./Georeference.vue?vue&type=script&lang=js&\"\nexport * from \"./Georeference.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Georeference.vue?vue&type=style&index=0&id=836ffa9e&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"836ffa9e\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"iiif zoom-controls-bottom-left\",attrs:{\"id\":\"iiif\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div id=\"iiif\" class=\"iiif zoom-controls-bottom-left\"></div>\n</template>\n\n<script>\nimport { mapState, mapActions, mapGetters } from 'vuex'\n\nimport Map from 'ol/Map'\nimport Feature from 'ol/Feature'\nimport View from 'ol/View'\nimport { Tile as TileLayer, Vector as VectorLayer } from 'ol/layer'\nimport { Draw, Modify } from 'ol/interaction'\nimport { Polygon} from 'ol/geom'\nimport { Vector as VectorSource} from 'ol/source'\nimport { Fill, Stroke, Style, Text } from 'ol/style'\nimport IIIF from 'ol/source/IIIF'\nimport IIIFInfo from 'ol/format/IIIFInfo'\n\nimport { createRandomId } from '@allmaps/id'\n\nimport { round } from '../lib/functions'\nimport { deleteCondition } from '../lib/openlayers'\n\n\nexport default {\n  name: 'PixelMask',\n  data () {\n    return {\n      dimensions: undefined\n    }\n  },\n  watch: {\n    activeMapId: function () {\n      this.updateStyles()\n      this.initializePixelMasks(this.maps)\n    },\n    activeImage: function () {\n      this.initializePixelMasks(this.maps)\n      this.updateImage(this.activeImage)\n    }\n  },\n  computed: {\n    ...mapState({\n      activeMapId: (state) => state.ui.activeMapId,\n      maps: (state) => state.maps.maps\n    }),\n    ...mapGetters('ui', {\n      activeImage: 'activeImage'\n    }),\n    source: function () {\n      return this.$options.name\n    }\n  },\n  methods: {\n    ...mapActions('maps', [\n      'insertMap',\n      'insertPixelMaskPoint',\n      'removePixelMaskPoint',\n      'replacePixelMaskPoint'\n    ]),\n    addFeature: function (map, index) {\n      const feature = new Feature({\n        index,\n        geometry: new Polygon(this.maskToPolygon(map.pixelMask))\n      })\n\n      feature.setId(map.id)\n      this.iiifSource.addFeature(feature)\n    },\n    onStoreMutation: function (mutation) {\n      if (mutation.payload.source === this.source) {\n        return\n      }\n\n      const mapId = mutation.payload.mapId\n\n      if (mutation.type === 'maps/insertMap') {\n        const map = mutation.payload.map\n        const index = Object.keys(this.maps).length - 1\n        this.addFeature(map, index)\n      } else if (mutation.type === 'maps/removeMap') {\n        const iiifFeature = this.iiifSource.getFeatureById(mapId)\n\n        if (iiifFeature) {\n          this.iiifSource.removeFeature(iiifFeature)\n        }\n      } else if ([\n        'maps/insertPixelMaskPoint',\n        'maps/replacePixelMaskPoint',\n        'maps/removePixelMaskPoint',\n        ].includes(mutation.type)) {\n          const iiifFeature = this.iiifSource.getFeatureById(mapId)\n          iiifFeature.setGeometry(new Polygon(this.maskToPolygon(this.maps[mapId].pixelMask)))\n        }\n    },\n    onResize: function () {\n      if (this.iiifOl) {\n        this.iiifOl.updateSize()\n      }\n    },\n    updateStyles: function () {\n      this.iiifVector.setStyle(this.maskStyle)\n    },\n    initializePixelMasks: function (maps) {\n      this.iiifSource.clear()\n\n      if (maps) {\n        Object.values(maps)\n          .forEach(this.addFeature)\n      }\n    },\n    pointsEqual: function (point1, point2) {\n      return point1[0] === point2[0] && point1[1] === point2[1]\n    },\n    polygonDifference: function (oldPolygon, newPolygon) {\n      const minLength = Math.min(oldPolygon.length, newPolygon.length)\n\n      let index = 0\n      for (index; index < minLength; index++) {\n        if (!this.pointsEqual(oldPolygon[index], newPolygon[index])) {\n          break\n        }\n      }\n\n      if (oldPolygon.length < newPolygon.length) {\n        // point inserted\n        return {\n          index,\n          operation: 'insert',\n          pixelMaskPoint: newPolygon[index]\n        }\n      } else if (oldPolygon.length > newPolygon.length) {\n        // point removed\n        return {\n          index,\n          operation: 'remove',\n          pixelMaskPoint: oldPolygon[index]\n        }\n      } else if (index < minLength) {\n        // point updated\n        return {\n          index,\n          operation: 'replace',\n          pixelMaskPoint: newPolygon[index]\n        }\n      }\n    },\n    onEdited: async function (event) {\n      if (event.type === 'addfeature') {\n        const feature = event.feature\n\n        if (feature.getId()) {\n          return\n        }\n\n        feature.setProperties({\n          index: Object.keys(this.maps).length\n        })\n\n        const mapId = await createRandomId()\n        feature.setId(mapId)\n\n        this.insertMap({\n          mapId,\n          image: {\n            id: this.activeImage.id,\n            uri: this.activeImage.uri,\n            width: this.activeImage.width,\n            height: this.activeImage.height,\n            version: this.activeImage.version,\n            quality: this.activeImage.quality,\n            format: this.activeImage.format\n          },\n          pixelMask: this.featurePolygon(feature),\n          source: this.source\n        })\n      } else if (event.type === 'modifystart') {\n        const feature = event.features.item(0)\n        if (feature) {\n          this.modifyingPolygon = this.featurePolygon(feature)\n        }\n      } else if (event.type === 'modifyend') {\n        if (event.features.getLength() > 1) {\n          // throw new Error('Multiple masks edited at once!')\n          console.error('Multiple masks edited at once!')\n        } else if (event.features.getLength() === 0) {\n          return\n        }\n\n        const feature = event.features.item(0)\n        const mapId = feature.getId()\n\n        const diff = this.polygonDifference(this.modifyingPolygon, this.featurePolygon(feature))\n        if (diff) {\n          const { operation, index, pixelMaskPoint } = diff\n          const payload = {\n            mapId,\n            index,\n            pixelMaskPoint,\n            source: this.source\n          }\n\n          if (operation === 'insert') {\n            this.insertPixelMaskPoint(payload)\n          } else if (operation === 'replace') {\n            this.replacePixelMaskPoint(payload)\n          } else if (operation === 'remove') {\n            this.removePixelMaskPoint(payload)\n          }\n        }\n\n        this.modifyingPolygon = undefined\n      }\n    },\n    updateImage: function (image) {\n      if (!image || image.stub) {\n        return\n      }\n\n      const options = new IIIFInfo(image.sourceData).getTileSourceOptions()\n      if (options === undefined || options.version === undefined) {\n        throw new Error('Data seems to be no valid IIIF image information.')\n      }\n\n      options.zDirection = -1\n      const iiifTileSource = new IIIF(options)\n      this.iiifLayer.setSource(iiifTileSource)\n\n      const extent = iiifTileSource.getTileGrid().getExtent()\n\n      this.dimensions = [extent[2], -extent[1]]\n\n      this.iiifOl.setView(new View({\n        enableRotation: false,\n        resolutions: iiifTileSource.getTileGrid().getResolutions(),\n        extent,\n        constrainOnlyCenter: true\n      }))\n\n      this.iiifOl.getView().fit(iiifTileSource.getTileGrid().getExtent(), {\n        // TODO: move to settings file\n        padding: [30 + 40 + 20, 10, 30 + 40 + 20, 10]\n      })\n    },\n    polygonToMask: function (polygon) {\n      return polygon[0].slice(0, -1).map((coordinate) => ([\n        coordinate[0],\n        -coordinate[1]\n      ].map((coordinate) => round(coordinate, 0))))\n    },\n    maskToPolygon: function (pixelMask) {\n      return [\n        [\n          ...pixelMask.map((coordinate) => ([\n            coordinate[0],\n            -coordinate[1]\n          ])),\n          [\n            pixelMask[0][0],\n            -pixelMask[0][1]\n          ]\n        ]\n      ]\n    },\n    featurePolygon: function (feature) {\n      return this.polygonToMask(feature.getGeometry().getCoordinates())\n    },\n    maskTextStyle: function (feature) {\n      return new Text({\n        scale: 1.5,\n        text: this.maskLabel(feature),\n        fill: new Fill({color: '#000'}),\n        stroke: new Stroke({color: '#fff', width: 2}),\n        placement: 'point',\n        align: 'center',\n        baseline: 'middle',\n        overflow: true\n      })\n    },\n    maskLabel: function (feature) {\n      const properties = feature.getProperties()\n      return `Map ${properties.index + 1}`\n    },\n    maskStyle: function (feature) {\n      const active = this.activeMapId === feature.getId()\n\n      return new Style({\n        stroke: new Stroke({\n          color: '#C552B5',\n          width: active ? 5 : 2\n        }),\n        text: this.maskTextStyle(feature)\n      })\n    }\n  },\n  mounted: function () {\n    this.iiifLayer = new TileLayer()\n    this.iiifSource = new VectorSource()\n\n    this.iiifVector = new VectorLayer({\n      source: this.iiifSource,\n      style: this.maskStyle\n    })\n\n    this.iiifOl = new Map({\n      layers: [this.iiifLayer, this.iiifVector],\n      target: 'iiif'\n    })\n\n    this.iiifModify = new Modify({\n      source: this.iiifSource,\n      deleteCondition\n    })\n    this.iiifOl.addInteraction(this.iiifModify)\n\n    const iiifDraw = new Draw({\n      source: this.iiifSource,\n      type: 'Polygon',\n      freehandCondition: (event) => false\n    })\n\n    this.iiifOl.addInteraction(iiifDraw)\n\n    this.iiifSource.on('addfeature', this.onEdited)\n    this.iiifModify.on('modifystart', this.onEdited)\n    this.iiifModify.on('modifyend', this.onEdited)\n\n    this.storeUnsubscribe = this.$store.subscribe(this.onStoreMutation)\n\n    this.updateImage(this.activeImage)\n    this.initializePixelMasks(this.maps)\n    this.updateStyles()\n  },\n  beforeDestroy: function () {\n    this.iiifSource.un('addfeature', this.onEdited)\n    this.iiifModify.un('modifystart', this.onEdited)\n    this.iiifModify.un('modifyend', this.onEdited)\n\n    this.storeUnsubscribe()\n  }\n}\n</script>\n\n<style scoped>\n.iiif {\n  width: 100%;\n  height: 100%;\n  background-color: var(--purple-4);\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PixelMask.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PixelMask.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PixelMask.vue?vue&type=template&id=094768ce&scoped=true&\"\nimport script from \"./PixelMask.vue?vue&type=script&lang=js&\"\nexport * from \"./PixelMask.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PixelMask.vue?vue&type=style&index=0&id=094768ce&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"094768ce\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"background section\"},[_c('div',{staticClass:\"container content\"},[_c('div',[_c('p',{staticClass:\"block\"},[_vm._v(\" Results page coming soon. \"),(_vm.activeImageId)?_c('span',[_vm._v(\" For now, you can view this map in the \"),_c('a',{attrs:{\"href\":_vm.viewerUrl}},[_vm._v(\"Allmaps Viewer\")]),_vm._v(\". \")]):_vm._e()])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"background section\">\n    <div class=\"container content\">\n      <div>\n        <p class=\"block\">\n          Results page coming soon. <span v-if=\"activeImageId\">\n          For now, you can view this map in\n          the <a :href=\"viewerUrl\">Allmaps Viewer</a>.\n          </span>\n        </p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapGetters, mapState } from 'vuex'\n\nexport default {\n  name: 'Results',\n  computed: {\n    ...mapGetters('iiif', {\n      manifestId: 'manifestId'\n    }),\n    ...mapState({\n      activeImageId: (state) => state.ui.activeImageId\n    }),\n    viewerUrl: function () {\n      const baseUrl = 'https://viewer.allmaps.org/#type=annotation&data=data:text/x-url,'\n      const annotationBaseUrl = 'https://annotations.allmaps.org'\n\n      let annotationUrl\n      if (this.manifestId) {\n        annotationUrl = `${annotationBaseUrl}/manifests/${this.manifestId}`\n      } else {\n        annotationUrl = `${annotationBaseUrl}/images/${this.activeImageId}`\n      }\n\n      return `${baseUrl}${encodeURIComponent(annotationUrl)}`\n    }\n  }\n}\n</script>\n\n<style scoped>\n.background {\n  background-color: var(--yellow-3);\n}\n\n.container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Results.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Results.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Results.vue?vue&type=template&id=16cdd194&scoped=true&\"\nimport script from \"./Results.vue?vue&type=script&lang=js&\"\nexport * from \"./Results.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Results.vue?vue&type=style&index=0&id=16cdd194&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"16cdd194\",\n  null\n  \n)\n\nexport default component.exports","const isObject = (obj) => typeof obj === 'object'\n\nconst isArray = (obj) => Array.isArray(obj)\n\nexport function parseOperations (op) {\n  if (isArray(op[0])) {\n    return op.map(parseOperations).flat()\n  } else {\n    const mapId = op[0]\n    return [parseMapOp(mapId, op.slice(1))].flat()\n  }\n}\n\nfunction parseMapOp (mapId, op) {\n  if (isArray(op[0])) {\n    return op.map((op) => parseMapOp(mapId, op))\n  } else if (isObject(op[0])) {\n    return {\n      mapId,\n      type: 'map',\n      instructions: op[0]\n    }\n  } else {\n    const prop = op[0]\n    return parsePropOp(mapId, prop, op.slice(1))\n  }\n}\n\nfunction parsePropOp (mapId, prop, op) {\n  if (isArray(op[0])) {\n    return op.map((op) => parsePropOp(mapId, prop, op))\n  } else if (isObject(op[0])) {\n    throw new Error('Oh no!')\n  } else {\n    const key = op[0]\n\n    return {\n      mapId,\n      type: prop,\n      key,\n      instructions: op[1]\n    }\n  }\n}\n","<template>\n  <div id=\"app\">\n    <div class=\"banner\">\n    This website is not yet finished. Not everything will work as intended,\n    and some things will not work at all. Follow <a href=\"https://twitter.com/bertspaan\">@bertspaan</a> for updates.\n    </div>\n    <div class=\"main\">\n      <Header />\n      <!-- TODO: check ERROR -->\n      <main>\n        <!-- TODO: replace !$route.query.url with store.ui.loaded -->\n        <template v-if=\"$route.name === 'home' || !$route.query.url\">\n          <Home />\n        </template>\n        <template v-else-if=\"$route.name === 'collection'\">\n          <Collection />\n        </template>\n        <template v-else-if=\"$route.name === 'mask'\">\n          <PixelMask />\n        </template>\n        <template v-else-if=\"$route.name === 'georeference'\">\n          <Georeference />\n        </template>\n        <template v-else-if=\"$route.name === 'results'\">\n          <Results />\n        </template>\n      </main>\n      <Drawer v-if=\"$route.name !== 'home'\" />\n      <Sidebar />\n    </div>\n  </div>\n</template>\n\n<style src='ol/ol.css'></style>\n<style src='highlight.js/styles/sunburst.css'></style>\n\n<script>\nimport { mapState, mapActions, mapGetters } from 'vuex'\n\nimport Header from './components/Header.vue'\nimport Drawer from './components/Drawer.vue'\nimport Sidebar from './components/Sidebar.vue'\n\nimport Home from './components/Home.vue'\nimport Collection from './components/Collection.vue'\nimport Georeference from './components/Georeference.vue'\nimport PixelMask from './components/PixelMask.vue'\nimport Results from './components/Results.vue'\n\nconst WS_API_URL = process.env.VUE_APP_WS_API_URL\nimport ReconnectingWebSocket from 'reconnecting-websocket'\nimport ShareDB from 'sharedb/lib/client'\nconst json1 = require('ot-json1')\n\nimport { parseOperations } from './lib/json1-operations.js'\n\nconst serverUrl = process.env.VUE_APP_SERVER_URL\n\nexport default {\n  name: 'app',\n  components: {\n    Header,\n    Drawer,\n    Sidebar,\n    Home,\n    Collection,\n    Georeference,\n    PixelMask,\n    Results\n  },\n  methods: {\n    ...mapActions('ui', [\n      'setActiveImageId',\n      'setActiveMapId',\n      'toggleDrawer',\n      'setSidebarOpen'\n    ]),\n\n    ...mapActions('maps', [\n      'setMaps',\n      'resetMaps',\n      'insertMap',\n      'removeMap',\n      'insertPixelMaskPoint',\n      'removePixelMaskPoint',\n      'replacePixelMaskPoint',\n      'insertGcp',\n      'replaceGcp',\n      'removeGcp'\n    ]),\n\n    ...mapActions('iiif', [\n      'setIiifUrl'\n    ]),\n\n    initializeDoc: function () {\n      const source = 'ShareDB'\n\n      let message\n      if (!this.doc.type) {\n        this.doc.create({}, json1.type.name)\n        message = 'Youre editing a new map.'\n      } else {\n        message = 'Someone has started georeferencing this map, you can continue editing to improve their work.'\n      }\n\n      message += ' All edits are automatically saved in the Allmaps database.'\n\n      this.$buefy.snackbar.open({\n        message,\n        position: 'is-top'\n      })\n\n      // TODO: we now have two versions of the maps data\n      // 1 in the ShareDB doc, one in the Vuex store\n      // This needs to be merged into one!\n      // For now:\n      const maps = JSON.parse(JSON.stringify(this.doc.data))\n\n      // either don't allow editing before share db is initialized,\n      // or merge the 2 set of maps\n\n      this.setMaps({ maps, source })\n    },\n    getDoc: function () {\n      if (this.doc) {\n        this.doc.removeListener('op', this.remoteOperation)\n        this.doc.unsubscribe()\n        this.doc.destroy()\n      }\n\n      this.doc = this.connection.get('images', this.activeImageId)\n\n      this.doc.subscribe(this.initializeDoc)\n      this.doc.on('op', this.remoteOperation)\n    },\n    remoteOperation: function (op, localOperation) {\n      if (!localOperation && op) {\n        // remote operation from server\n\n        const source = 'ShareDB'\n\n        const operations = parseOperations(op)\n\n        operations.forEach(({ mapId, type, key, instructions }) => {\n          if (type === 'map' && instructions.i) {\n            const { image, pixelMask, gcps } = instructions.i\n            this.insertMap({\n              mapId,\n              image,\n              pixelMask,\n              gcps,\n              source\n            })\n          } else if (type === 'map' && instructions.r) {\n            this.removeMap({ mapId, source })\n          } else if (type === 'pixelMask') {\n            const index = key\n            const pixelMaskPoint = instructions.i\n\n            if (instructions.r && pixelMaskPoint) {\n              this.replacePixelMaskPoint({\n                mapId, index, pixelMaskPoint, source\n              })\n            } else if (pixelMaskPoint) {\n              this.insertPixelMaskPoint({\n                mapId, index, pixelMaskPoint, source\n              })\n            } else if (instructions.r) {\n              this.removePixelMaskPoint({\n                mapId, index, pixelMaskPoint, source\n              })\n            }\n          } else if (type === 'gcps') {\n            const gcpId = key\n            const gcp = instructions.i\n\n            if (instructions.r && gcp) {\n              this.replaceGcp({\n                mapId, gcpId, gcp, source\n              })\n            } else if (gcp) {\n              this.insertGcp({\n                mapId, gcpId, gcp, source\n              })\n            } else if (instructions.r) {\n              this.removeGcp({\n                mapId, gcpId, source\n              })\n            }\n          }\n        })\n      }\n    },\n    onStoreMutation: function (mutation) {\n      if (mutation.payload.source === 'ShareDB') {\n        return\n      }\n\n      if (mutation.type === 'maps/insertMap') {\n        const { mapId, map } = mutation.payload\n\n        // TODO: make map immutable, or use this.doc as store\n        this.doc.submitOp(json1.insertOp([mapId], JSON.parse(JSON.stringify(map))))\n      } else if (mutation.type === 'maps/removeMap') {\n        const { mapId } = mutation.payload\n        this.doc.submitOp(json1.removeOp([mapId]))\n      } else if (mutation.type === 'maps/insertPixelMaskPoint') {\n        const { mapId, index, pixelMaskPoint } = mutation.payload\n        this.doc.submitOp(json1.insertOp([mapId, 'pixelMask', index], pixelMaskPoint))\n      } else if (mutation.type === 'maps/removePixelMaskPoint') {\n        const { mapId, index, pixelMaskPoint } = mutation.payload\n        this.doc.submitOp(json1.removeOp([mapId, 'pixelMask', index], pixelMaskPoint))\n      } else if (mutation.type === 'maps/replacePixelMaskPoint') {\n        const { mapId, index, pixelMaskPoint } = mutation.payload\n        // TODO: replace true with oldVal\n        this.doc.submitOp(json1.replaceOp([mapId, 'pixelMask', index], true, pixelMaskPoint))\n      } else if (mutation.type === 'maps/insertGcp') {\n        const { mapId, gcpId, gcp } = mutation.payload\n        // if (gcp.image && gcp.world) {\n          this.doc.submitOp(json1.insertOp([mapId, 'gcps', gcpId], {...gcp}))\n        // }\n      } else if (mutation.type === 'maps/replaceGcp') {\n        const { mapId, gcpId, gcp } = mutation.payload\n        // if (gcp.image && gcp.world) {\n          // TODO: replace true with oldVal\n          this.doc.submitOp(json1.replaceOp([mapId, 'gcps', gcpId], true, {...gcp}))\n        // }\n      } else if (mutation.type === 'maps/removeGcp') {\n        const { mapId, gcpId, gcp } = mutation.payload\n        // if (gcp.image && gcp.world) {\n          this.doc.submitOp(json1.removeOp([mapId, 'gcps', gcpId]))\n        // }\n      }\n    },\n    goToRoute: function (name) {\n      this.$router.push({ name, query: this.$route.query })\n    },\n    keyPressHandler: function (event) {\n      if (event.key === '[') {\n        if (!this.activeImage || !this.activeImage.previousImageId) {\n          return\n        }\n\n        this.$router.push({name: this.$route.name, query: {\n          ...this.$route.query,\n          image: this.activeImage.previousImageId\n        }})\n      } else if (event.key === ']') {\n        if (!this.activeImage || !this.activeImage.nextImageId) {\n          return\n        }\n\n        this.$router.push({name: this.$route.name, query: {\n          ...this.$route.query,\n          image: this.activeImage.nextImageId\n        }})\n      } else if (event.key === '{') {\n        this.setActiveMapId({ mapId: this.previousMapId })\n      } else if (event.key === '}') {\n        this.setActiveMapId({ mapId: this.nextMapId })\n      } else if (event.key === '1') {\n        this.goToRoute('collection')\n      } else if (event.key === '2') {\n        this.goToRoute('mask')\n      } else if (event.key === '3') {\n        this.goToRoute('georeference')\n      } else if (event.key === '4') {\n        this.goToRoute('results')\n      } else if (event.key === '0') {\n        this.goToRoute('home')\n      } else if (event.key === 'i') {\n        this.toggleDrawer('metadata')\n      } else if (event.key === 'm') {\n        this.toggleDrawer('maps')\n      } else if (event.key === 'a') {\n        this.toggleDrawer('annotation')\n      }\n    }\n  },\n  computed: {\n    ...mapState({\n      activeImageId: (state) => state.ui.activeImageId,\n      maps: (state) => state.maps.maps\n    }),\n    ...mapGetters('ui', {\n      activeImage: 'activeImage',\n      previousMapId: 'previousMapId',\n      nextMapId: 'nextMapId'\n    }),\n    fullscreen: function () {\n      return this.$route.name === 'mask' || this.$route.name === 'georeference' || this.$route.name === 'results'\n    },\n  },\n  watch: {\n    '$route.name': function () {\n      this.setSidebarOpen({ open: false })\n    },\n    '$route.query.url': function (url) {\n      this.setSidebarOpen({ open: false })\n      this.setIiifUrl({ url, imageId: this.$route.query.image })\n    },\n    '$route.query.image': function (imageId) {\n      if (imageId && this.activeImageId !== imageId) {\n        this.setSidebarOpen({ open: false })\n        this.setActiveImageId({ imageId })\n      }\n    },\n    activeImageId: function () {\n      this.resetMaps()\n      this.getDoc()\n    }\n  },\n  mounted: async function () {\n    const url = this.$route.query.url\n\n    if (url) {\n      this.setIiifUrl({ url, imageId: this.$route.query.image })\n    }\n\n    window.addEventListener('keypress', this.keyPressHandler)\n\n    this.rws = new ReconnectingWebSocket(WS_API_URL)\n    ShareDB.types.register(json1.type)\n    this.connection = new ShareDB.Connection(this.rws)\n\n    this.storeUnsubscribe = this.$store.subscribe(this.onStoreMutation)\n  },\n  beforeDestroy: function () {\n    window.removeEventListener('keypress', this.keyPressHandler)\n\n    this.storeUnsubscribe()\n\n    // TODO: check MaxListenersExceededWarning\n    if (this.doc) {\n      this.doc.destroy()\n    }\n\n    this.connection.close()\n    this.rws.close()\n  }\n}\n</script>\n\n<style>\nhtml {\n  height: 100%;\n}\n\nbody {\n  margin: 0;\n  padding: 0;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n\n\tfont-family: 'Roboto', sans-serif;\n\tfont-size: 18px;\n}\n\n.monospace {\n\tfont-family: 'Roboto Mono', monospace;\n}\n\nmain p a, main ul a, main ol a {\n  word-break: break-all;\n}\n\n.padding {\n  padding: 0.5em;\n  box-sizing: border-box;\n}\n\n* {\n  box-sizing: border-box;\n}\n\n.banner {\n  background-color: #E22D3F;\n  color: white;\n  padding: 0.5em;\n  font-size: 75%;\n}\n\n.banner a, .banner a:visited {\n  color: white;\n}\n\n#app {\n  /* font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial,\n    sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; */\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  font-size: 18px;\n\n  color: var(--black);\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n  max-height: 100%;\n  min-height: 100%;\n}\n\n.main {\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n}\n\nmain {\n  height: 0px;\n  min-height: auto;\n\n  display: flex;\n  flex: 1 0 auto;\n  flex-direction: row;\n}\n\nmain > * {\n  width: 100%;\n  box-sizing: border-box;\n  overflow-y: auto;\n}\n\nheader, footer,\na, a:visited {\n  color: #2c3e50;\n}\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=4b3ae19d&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"ol/ol.css?vue&type=style&index=0&lang=css&\"\nimport style1 from \"highlight.js/styles/sunburst.css?vue&type=style&index=1&lang=css&\"\nimport style2 from \"./App.vue?vue&type=style&index=2&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\n\nimport { ToastProgrammatic as Toast } from 'buefy'\n\nfunction makeMapActive (rootState, mapId, commit) {\n  if (rootState.ui.activeMapId !== mapId) {\n    commit('ui/setActiveMapId', { mapId }, { root: true })\n  }\n}\n\nfunction makeOtherMapActive (rootState, mapId, commit) {\n  if (rootState.ui.activeMapId !== mapId) {\n    return\n  }\n\n  let otherMapId\n  for (let loopMapId of Object.keys(rootState.maps.maps)) {\n    if (loopMapId !== mapId) {\n      otherMapId = loopMapId\n      break\n    }\n  }\n\n  commit('ui/setActiveMapId', { mapId: otherMapId }, { root: true })\n}\n\nconst state = () => ({\n  maps: {}\n})\n\nconst getters = {\n  activeMap: (state, getters, rootState) => {\n    const activeMapId = rootState.ui.activeMapId\n    const activeMap = state.maps[activeMapId]\n    return activeMap\n  }\n  // mapsForActiveImage: (state, getters, rootState) => {\n  //   const activeImageId = rootState.ui.activeImageId\n\n  //   return Object.keys(state.maps)\n  //     .filter((id) => state.maps[id].image.id === activeImageId)\n  //     .reduce((maps, id) => ({\n  //       ...maps,\n  //       [id]: state.maps[id]\n  //     }), {})\n  // }\n}\n\nconst actions = {\n  undo () {\n    Toast.open({\n      message: 'Not yet implemented ',\n      type: 'is-danger'\n    })\n  },\n\n  redo () {\n    Toast.open({\n      message: 'Not yet implemented ',\n      type: 'is-danger'\n    })\n  },\n\n  setMaps ({ commit, rootState }, { maps, source }) {\n    commit('setMaps', { maps, source })\n\n    if (Object.keys(maps).length) {\n      const firstMapId = Object.keys(maps)[0]\n      if (firstMapId) {\n        makeMapActive(rootState, firstMapId, commit)\n      }\n    }\n  },\n\n  resetMaps ({ dispatch }) {\n    dispatch('setMaps', { maps: {} })\n  },\n\n  insertMap ({ commit, rootState }, { mapId, pixelMask = [], gcps = {}, image, source }) {\n    const map = {\n      version: 2,\n      id: mapId,\n      image,\n      pixelMask,\n      gcps\n    }\n\n    commit('insertMap', { mapId, map, source })\n    makeMapActive(rootState, mapId, commit)\n  },\n\n  removeMap ({ commit, rootState }, { mapId, source }) {\n    makeOtherMapActive(rootState, mapId, commit)\n    commit('removeMap', { mapId, source })\n  },\n\n  insertPixelMaskPoint ({ state, commit, rootState }, { mapId, index, pixelMaskPoint, source }) {\n    if (!state.maps[mapId]) {\n      throw new Error(`Map ${mapId} does not exist`)\n    }\n\n    commit('insertPixelMaskPoint', {\n      mapId, index, pixelMaskPoint, source\n    })\n\n    makeMapActive(rootState, mapId, commit)\n  },\n\n  replacePixelMaskPoint ({ commit, rootState }, { mapId, index, pixelMaskPoint, source }) {\n    commit('replacePixelMaskPoint', {\n      mapId, index, pixelMaskPoint, source\n    })\n\n    makeMapActive(rootState, mapId, commit)\n  },\n\n  removePixelMaskPoint ({ commit, rootState }, { mapId, index, source }) {\n    commit('removePixelMaskPoint', {\n      mapId, index, source\n    })\n\n    makeMapActive(rootState, mapId, commit)\n  },\n\n  insertGcp ({ state, commit }, { mapId, gcpId, gcp, source }) {\n    if (!state.maps[mapId]) {\n      throw new Error(`Map ${mapId} does not exist`)\n    }\n\n    if (state.maps[mapId].gcps[gcpId]) {\n      throw new Error(`GCP ${gcpId} already exists`)\n    }\n\n    commit('insertGcp', {\n      mapId, gcpId, gcp, source\n    })\n  },\n\n  replaceGcp ({ state, commit }, { mapId, gcpId, gcp, source }) {\n    if (!state.maps[mapId]) {\n      throw new Error(`Map ${mapId} does not exist`)\n    }\n\n    if (!state.maps[mapId].gcps[gcpId]) {\n      throw new Error(`GCP ${gcpId} does not exist`)\n    }\n\n    commit('replaceGcp', {\n      mapId, gcpId, gcp, source\n    })\n  },\n\n  removeGcp ({ state, commit }, { mapId, gcpId, gcp, source }) {\n    if (!state.maps[mapId]) {\n      throw new Error(`Map ${mapId} does not exist`)\n    }\n\n    if (!state.maps[mapId].gcps[gcpId]) {\n      throw new Error(`GCP ${gcpId} does not exist`)\n    }\n\n    commit('removeGcp', {\n      mapId, gcpId, gcp, source\n    })\n  }\n}\n\nconst mutations = {\n  setMaps (state, { maps }) {\n    state.maps = maps\n  },\n\n  insertMap (state, { mapId, map }) {\n    if (!state.maps[mapId]) {\n      Vue.set(state.maps, mapId, map)\n\n      // In Vue 3:\n      // state.maps = {\n      //   ...state.maps,\n      //   [mapId]: map\n      // }\n    } else {\n      throw new Error('Map already exists!')\n    }\n  },\n\n  removeMap (state, { mapId }) {\n    Vue.delete(state.maps, mapId)\n\n    // In Vue 3:\n    // delete state.maps[mapId]\n  },\n\n  insertPixelMaskPoint (state, { mapId, index, pixelMaskPoint }) {\n    const map = state.maps[mapId]\n\n    const pixelMask = map.pixelMask\n    pixelMask.splice(index, 0, pixelMaskPoint)\n\n    Vue.set(state.maps, mapId, map)\n\n    // In Vue 3:\n    // state.maps = {\n    //   ...state.maps,\n    //   [mapId]: map\n    // }\n  },\n\n  replacePixelMaskPoint (state, { mapId, index, pixelMaskPoint }) {\n    const map = state.maps[mapId]\n    map.pixelMask[index] = pixelMaskPoint\n\n    Vue.set(state.maps, mapId, map)\n\n    // In Vue 3:\n    // state.maps = {\n    //   ...state.maps,\n    //   [mapId]: map\n    // }\n  },\n\n  removePixelMaskPoint (state, { mapId, index }) {\n    const map = state.maps[mapId]\n    map.pixelMask.splice(index, 1)\n\n    Vue.set(state.maps, mapId, map)\n\n    // In Vue 3:\n    // state.maps = {\n    //   ...state.maps,\n    //   [mapId]: map\n    // }\n  },\n\n  insertGcp (state, { mapId, gcpId, gcp }) {\n    const map = state.maps[mapId]\n\n    Vue.set(map.gcps, gcpId, {\n      id: gcpId,\n      ...gcp\n    })\n\n    Vue.set(state.maps, mapId, map)\n\n    // In Vue 3:\n    // map.gcps = {\n    //   ...map.gcps,\n    //   [gcpId]: {\n    //     id: gcpId,\n    //     ...gcp\n    //   }\n    // }\n\n    // state.maps = {\n    //   ...state.maps,\n    //   [mapId]: map\n    // }\n  },\n\n  replaceGcp (state, { mapId, gcpId, gcp }) {\n    const map = state.maps[mapId]\n\n    Vue.set(map.gcps, gcpId, {\n      id: gcpId,\n      ...gcp\n    })\n\n    Vue.set(state.maps, mapId, map)\n\n    // In Vue 3:\n    // map.gcps = {\n    //   ...map.gcps,\n    //   [gcpId]: {\n    //     id: gcpId,\n    //     ...gcp\n    //   }\n    // }\n\n    // state.maps = {\n    //   ...state.maps,\n    //   [mapId]: map\n    // }\n  },\n\n  removeGcp (state, { mapId, gcpId }) {\n    const map = state.maps[mapId]\n\n    Vue.delete(map.gcps, gcpId)\n    Vue.set(state.maps, mapId, map)\n\n    // In Vue 3:\n    // delete map.gcps[gcpId]\n\n    // state.maps = {\n    //   ...state.maps,\n    //   [mapId]: map\n    // }\n  }\n}\n\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n}\n","const state = () => ({\n  sidebarOpen: false,\n  drawerOpen: undefined,\n  lastError: undefined,\n  activeImageId: undefined,\n  activeMapId: undefined,\n  loading: false\n})\n\nconst getters = {\n  activeImage: (state, getters, rootState) => {\n    return rootState.iiif.imagesById[state.activeImageId]\n  },\n\n  previousMapId: (state, getters, rootState) => {\n    if (!state.activeMapId) {\n      return\n    }\n\n    const mapIds = Object.keys(rootState.maps.maps)\n    const currentMapIndex = mapIds.indexOf(state.activeMapId)\n    const newMapIndex = (currentMapIndex - 1 + mapIds.length) % mapIds.length\n    return mapIds[newMapIndex]\n  },\n\n  nextMapId: (state, getters, rootState) => {\n    if (!state.activeMapId) {\n      return\n    }\n\n    const mapIds = Object.keys(rootState.maps.maps)\n    const currentMapIndex = mapIds.indexOf(state.activeMapId)\n    const newMapIndex = (currentMapIndex + 1 + mapIds.length) % mapIds.length\n    return mapIds[newMapIndex]\n  }\n}\n\nconst actions = {\n  setActiveImageId ({ commit, dispatch, rootState }, { imageId }) {\n    if (!rootState.iiif.imagesById[imageId]) {\n      throw new Error(`Image ID does not exist in IIIF source: ${imageId}`)\n    }\n\n    dispatch('maps/resetMaps', { maps: {} }, { root: true })\n\n    commit('setActiveImageId', { imageId })\n    commit('setActiveMapId', { mapId: undefined })\n  },\n\n  setActiveMapId ({ commit, rootState }, { mapId }) {\n    if (rootState.maps.maps[mapId]) {\n      commit('setActiveMapId', { mapId })\n    }\n  },\n\n  setSidebarOpen ({ state, commit }, { open }) {\n    if (state.sidebarOpen !== open) {\n      commit('setSidebarOpen', { open })\n    }\n  },\n\n  toggleDrawer ({ state, commit }, drawer) {\n    const drawerOpen = state.drawerOpen === drawer ? undefined : drawer\n    commit('setDrawerOpen', { drawer: drawerOpen })\n  }\n}\n\nconst mutations = {\n  setActiveImageId (state, { imageId }) {\n    state.activeImageId = imageId\n  },\n  setActiveMapId (state, { mapId }) {\n    state.activeMapId = mapId\n  },\n  setSidebarOpen (state, { open }) {\n    state.sidebarOpen = open\n  },\n  setDrawerOpen (state, { drawer }) {\n    state.drawerOpen = drawer\n  }\n}\n\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n}\n","/* global fetch */\n\nimport { createChecksum } from '@allmaps/id'\n\nconst API_URL = process.env.VUE_APP_API_URL\n\nexport function fetchJson (url) {\n  return fetch(url)\n    .then((response) => response.json())\n}\n\nexport async function submitIiif (url, type, id, data) {\n  const checksum = await createChecksum(data)\n\n  const apiUrl = `${API_URL}/${type}s/${id}`\n\n  const apiData = {\n    url,\n    checksum\n  }\n\n  const response = await fetch(apiUrl, {\n    method: 'PUT',\n    headers: {\n      'Content-type': 'application/json'\n    },\n    body: JSON.stringify(apiData)\n  })\n\n  const responseData = await response.json()\n  return responseData\n}\n","/* global DOMParser */\n\nimport Vue from 'vue'\n\nimport { router } from '../../main.js'\n\nimport { createId } from '@allmaps/id'\nimport { parseIiif } from '@allmaps/iiif-parser'\n\nimport { fetchJson, submitIiif } from '../../lib/api.js'\n\nfunction getString (value) {\n  if (Array.isArray(value)) {\n    // TODO: don't pick first value, return list of values\n    return getString(value[0])\n  } else if (typeof value === 'object') {\n    if (value.en) {\n      return getString(value.en)\n    } else {\n      return getString(Object.values(value)[0])\n    }\n  } else if (typeof value === 'object' && value['@value']) {\n    return getString(value['@value'])\n  } else if (value && value.includes('<')) {\n    let doc = new DOMParser().parseFromString(value, 'text/html')\n    return doc.body.textContent || ''\n  } else {\n    return value\n  }\n}\n\nconst initialState = {\n  loaded: false,\n  url: undefined,\n  type: undefined,\n  parsedIiif: undefined,\n  imagesById: {}\n}\n\nconst state = () => initialState\n\nconst getters = {\n  manifestId: (state) => {\n    return state.parsedIiif.type === 'manifest' && state.parsedIiif.id\n  },\n  imageCount: (state) => {\n    return Object.keys(state.imagesById).length\n  },\n  label: (state) => {\n    return state.parsedIiif && getString(state.parsedIiif.sourceData.label)\n  },\n  description: (state) => {\n    return state.parsedIiif && getString(state.parsedIiif.sourceData.description)\n  },\n  metadata: (state) => {\n    if (state.parsedIiif) {\n      if (state.parsedIiif.sourceData.metadata && state.parsedIiif.sourceData.metadata.length) {\n        return state.parsedIiif.sourceData.metadata\n          .map(({ label, value }) => ({\n            label: getString(label),\n            value: getString(value)\n          }))\n          .filter(({ label, value }) => label && value)\n      }\n    }\n  }\n}\n\nconst actions = {\n  async setIiifUrl ({ commit, dispatch }, { url, imageId }) {\n    if (!url) {\n      return\n    }\n\n    // TODO: set loading, make sure old images are not displayed\n    commit('maps/setMaps', { maps: {} }, { root: true })\n\n    const sourceIiif = await fetchJson(url)\n    let parsedIiif = parseIiif(sourceIiif)\n    const type = parsedIiif.type\n\n    // Add IDs to parsed IIIF data\n    parsedIiif.id = await createId(parsedIiif.uri)\n    if (type === 'image') {\n      parsedIiif.stub = false\n    } else if (type === 'manifest') {\n      for (let image of parsedIiif.images) {\n        image.id = await createId(image.uri)\n\n        // Image data comes from manifest.\n        // For each image, we need to download the info.json file.\n        // Until then, mark the image as stub.\n        // TODO: consider moving this to iiif-parser\n        image.stub = true\n      }\n    } else {\n      throw new Error(`Unsupported IIIF type: ${type}`)\n    }\n\n    submitIiif(url, parsedIiif.type, parsedIiif.id, sourceIiif)\n\n    const images = type === 'image' ? [parsedIiif] : parsedIiif.images\n    const imagesById = images.reduce((imagesById, image, index) => ({\n      ...imagesById,\n      [image.id]: {\n        ...image,\n        index,\n        previousImageId: images[index - 1] && images[index - 1].id,\n        nextImageId: images[index + 1] && images[index + 1].id\n      }\n    }), {})\n\n    commit('setIiif', { url, type, parsedIiif, imagesById })\n\n    let newRoute\n    let newImageId\n\n    if (imageId && imagesById[imageId]) {\n      newImageId = imageId\n    } else {\n      newImageId = images[0].id\n\n      newRoute = {\n        name: router.currentRoute.name,\n        query: {\n          ...router.currentRoute.query,\n          image: newImageId\n        }\n      }\n    }\n\n    if (imagesById[newImageId].stub) {\n      dispatch('loadImageInfo', { imageId: newImageId })\n    }\n\n    if (newRoute) {\n      router.push(newRoute)\n    }\n\n    commit('ui/setActiveImageId', { imageId: newImageId }, { root: true })\n\n    if (parsedIiif.type === 'manifest') {\n      images\n        .filter((image) => image.stub)\n        .forEach((image) => dispatch('loadImageInfo', { imageId: image.id }))\n    }\n  },\n\n  async loadImageInfo ({ state, commit }, { imageId }) {\n    if (state.imagesById[imageId] && state.imagesById[imageId].stub) {\n      const imageStub = state.imagesById[imageId]\n\n      const url = `${imageStub.uri}/info.json`\n      const sourceIiif = await fetchJson(url)\n      let parsedIiif = parseIiif(sourceIiif)\n      const type = parsedIiif.type\n\n      if (type === 'image') {\n        // Add ID and previously computed data to parsed IIIF image data\n        const parsedImage = {\n          ...parsedIiif,\n          id: await createId(parsedIiif.uri),\n          stub: false,\n          index: imageStub.index,\n          previousImageId: imageStub.previousImageId,\n          nextImageId: imageStub.nextImageId\n        }\n\n        if (parsedImage.id === imageId) {\n          commit('setImage', { imageId, parsedImage })\n        } else {\n          throw new Error(`Image IDs don't match`)\n        }\n      } else {\n        throw new Error(`IIIF data is not an image`)\n      }\n    }\n  }\n}\n\nconst mutations = {\n  setIiif (state, { url, type, parsedIiif, imagesById }) {\n    state.loaded = true\n    state.url = url\n    state.type = type\n    state.parsedIiif = parsedIiif\n    state.imagesById = imagesById\n  },\n\n  setImage (state, { imageId, parsedImage }) {\n    Vue.set(state.imagesById, imageId, parsedImage)\n  }\n}\n\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n}\n","import Vue from 'vue'\nimport Vuex from 'vuex'\n\nimport maps from './modules/maps'\nimport ui from './modules/ui'\nimport iiif from './modules/iiif'\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({\n  modules: {\n    maps,\n    ui,\n    iiif\n  }\n})\n","import Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport Buefy from 'buefy'\n\nimport 'buefy/dist/buefy.css'\nimport './assets/base.scss'\n\nimport hljs from 'highlight.js'\n\nimport App from './App.vue'\nimport store from './store'\n\nVue.use(VueRouter)\nVue.use(Buefy, {\n  defaultIconPack: 'fas',\n  defaultContainerElement: '#content'\n})\n\nVue.config.productionTip = false\n\nVue.directive('highlightjs', {\n  deep: true,\n  bind: function (el, binding) {\n    // on first bind, highlight all targets\n    let targets = el.querySelectorAll('code')\n    targets.forEach((target) => {\n      // if a value is directly assigned to the directive, use this\n      // instead of the element content.\n      if (binding.value) {\n        target.textContent = binding.value\n      }\n      hljs.highlightBlock(target)\n    })\n  },\n  componentUpdated: function (el, binding) {\n    // after an update, re-fill the content and then highlight\n    let targets = el.querySelectorAll('code')\n    targets.forEach((target) => {\n      if (binding.value) {\n        target.textContent = binding.value\n        hljs.highlightBlock(target)\n      }\n    })\n  }\n})\n\n// TODO: New routes??\n// ?uri=uri, redirect to /i or /m\n// /i/:id\n// /m/:id/i/:id\n// /m/:id/i/:id/preview\n// /m/:id/i/:id/georeference\n\nexport const router = new VueRouter({\n  routes: [\n    {\n      name: 'home',\n      path: '/',\n      component: App\n    },\n    {\n      name: 'collection',\n      path: '/collection',\n      component: App\n    },\n    {\n      name: 'georeference',\n      path: '/georeference',\n      component: App\n    },\n    {\n      name: 'mask',\n      path: '/mask',\n      component: App\n    },\n    {\n      name: 'results',\n      path: '/results',\n      component: App\n    }\n  ]\n})\n\nnew Vue({\n  router,\n  store,\n  render: h => h(App)\n}).$mount('#app')\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Drawer.vue?vue&type=style&index=0&id=524c1226&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Collection.vue?vue&type=style&index=0&id=f6a0d8ce&scoped=true&lang=css&\"","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=2&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PixelMask.vue?vue&type=style&index=0&id=094768ce&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Results.vue?vue&type=style&index=0&id=16cdd194&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Thumbnail.vue?vue&type=style&index=0&id=bbefe63c&scoped=true&lang=css&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Annotation.vue?vue&type=style&index=0&id=27e1be1f&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&id=3aab7ea2&scoped=true&lang=css&\""],"sourceRoot":""}